"use strict";var e=require("../../../../../common/vendor.js"),t=require("./z-paging-static.js"),i=require("./z-paging-constant.js"),o=require("./z-paging-utils.js"),s=require("./modules/data-handle.js"),n=require("./modules/i18n.js"),a=require("./modules/nvue.js"),l=require("./modules/empty.js"),r=require("./modules/refresher.js"),h=require("./modules/load-more.js"),d=require("./modules/scroller.js"),g=require("./modules/back-to-top.js"),u=require("./modules/virtual-list.js"),c=require("./z-paging-enum.js");const p=e.index.getSystemInfoSync();var m={name:"z-paging",components:{zPagingRefresh:()=>"../components/z-paging-refresh.js",zPagingLoadMore:()=>"../components/z-paging-load-more.js",zPagingEmptyView:()=>"../../z-paging-empty-view/z-paging-empty-view.js"},mixins:[s.ZPData,n.ZPI18n,a.ZPNvue,l.ZPEmptyView,r.ZPRefresher,h.ZPLoadMore,d.ZPScroller,g.ZPBackToTop,u.ZPVirtualList],data:()=>({base64Arrow:t.zStatic.base64Arrow,base64Flower:t.zStatic.base64Flower,base64BackToTop:t.zStatic.base64BackToTop,loadingType:c.Enum.LoadingType.Refresher,requestTimeStamp:0,chatRecordLoadingMoreText:"",wxsPropType:"",renderPropScrollTop:-1,renderPropUsePageScroll:-1,checkScrolledToBottomTimeOut:null,systemInfo:null,cssSafeAreaInsetBottom:-1,cacheTopHeight:-1,insideOfPaging:-1,loading:!1,loadingForNow:!1,isLoadFailed:!1,isIos:"ios"===p.platform,disabledBounce:!1,fromCompleteEmit:!1,disabledCompleteEmit:!1,wxsIsScrollTopInTopRange:!0,wxsScrollTop:0,wxsPageScrollTop:0,wxsOnPullingDown:!1}),props:{delay:{type:[Number,String],default:o.u.gc("delay",0)},minDelay:{type:[Number,String],default:o.u.gc("minDelay",0)},pagingStyle:{type:Object,default:function(){return o.u.gc("pagingStyle",{})}},height:{type:String,default:o.u.gc("height","")},width:{type:String,default:o.u.gc("width","")},bgColor:{type:String,default:o.u.gc("bgColor","")},pagingContentStyle:{type:Object,default:function(){return o.u.gc("pagingContentStyle",{})}},autoHeight:{type:Boolean,default:o.u.gc("autoHeight",!1)},autoHeightAddition:{type:[Number,String],default:o.u.gc("autoHeightAddition","0px")},defaultThemeStyle:{type:String,default:function(){return o.u.gc("defaultThemeStyle","black")}},fixed:{type:Boolean,default:o.u.gc("fixed",!0)},safeAreaInsetBottom:{type:Boolean,default:o.u.gc("safeAreaInsetBottom",!1)},useSafeAreaPlaceholder:{type:Boolean,default:o.u.gc("useSafeAreaPlaceholder",!1)},autoHideLoadingAfterFirstLoaded:{type:Boolean,default:o.u.gc("autoHideLoadingAfterFirstLoaded",!0)},loadingFullFixed:{type:Boolean,default:o.u.gc("loadingFullFixed",!1)},topZIndex:{type:Number,default:o.u.gc("topZIndex",99)},superContentZIndex:{type:Number,default:o.u.gc("superContentZIndex",1)},contentZIndex:{type:Number,default:o.u.gc("contentZIndex",10)},autoFullHeight:{type:Boolean,default:o.u.gc("autoFullHeight",!0)},watchTouchDirectionChange:{type:Boolean,default:o.u.gc("watchTouchDirectionChange",!1)},showConsoleError:{type:Boolean,default:o.u.gc("showConsoleError",!0)}},created(){this.createdReload&&!this.refresherOnly&&this.mountedAutoCallReload&&this.auto&&(this._startLoading(),this._preReload())},mounted(){this.wxsPropType=o.u.getTime().toString(),this.renderJsIgnore,!this.createdReload&&!this.refresherOnly&&this.mountedAutoCallReload&&this.auto&&this.$nextTick((()=>{this._preReload()}));let t=0;t=100,this.$nextTick((()=>{this.systemInfo=e.index.getSystemInfoSync(),!this.usePageScroll&&this.autoHeight&&this._setAutoHeight(),this.loaded=!0})),this.updatePageScrollTopHeight(),this.updatePageScrollBottomHeight(),this._updateLeftAndRightWidth(),this.finalRefresherEnabled&&this.useCustomRefresher&&this.$nextTick((()=>{this.isTouchmoving=!0})),this._onEmit(),this.finalUseVirtualList&&this._virtualListInit(),this.$nextTick((()=>{setTimeout((()=>{this._getCssSafeAreaInsetBottom()}),100)}))},destroyed(){this._offEmit()},unmounted(){this._offEmit()},watch:{loadingStatus(e,t){this.$emit("loadingStatusChange",e),this.$nextTick((()=>{this.loadingStatusAfterRender=e}))},loading(e){e&&(this.loadingForNow=e)},defaultThemeStyle:{handler(e){e.length&&(this.finalRefresherDefaultStyle=e)},immediate:!0},autoHeight(e,t){this.loaded&&!this.usePageScroll&&this._setAutoHeight(e)},autoHeightAddition(e,t){this.loaded&&!this.usePageScroll&&this.autoHeight&&this._setAutoHeight(e)}},computed:{zScopedSlots(){return this.$scopedSlots},finalPagingStyle(){const e=this.pagingStyle;if(!this.systemInfo)return e;const t=this.windowTop,i=this.windowBottom;return!this.usePageScroll&&this.fixed&&(t&&!e.top&&(e.top=t+"px"),i&&!e.bottom&&(e.bottom=i+"px")),this.bgColor.length&&!e.background&&(e.background=this.bgColor),this.height.length&&!e.height&&(e.height=this.height),this.width.length&&!e.width&&(e.width=this.width),e},finalLowerThreshold(){return o.u.convertTextToPx(this.lowerThreshold)},finalPagingContentStyle(){return 1!=this.contentZIndex&&(this.pagingContentStyle["z-index"]=this.contentZIndex,this.pagingContentStyle.position="relative"),this.pagingContentStyle},showLoading(){return!(this.firstPageLoaded||!this.loading||!this.loadingForNow)&&(this.autoHideLoadingAfterFirstLoaded?!!this.fromEmptyViewReload||!this.pagingLoaded:this.loadingType===c.Enum.LoadingType.Refresher)},safeAreaBottom(){if(!this.systemInfo)return 0;let e=0;return e=-1===this.cssSafeAreaInsetBottom?0:this.cssSafeAreaInsetBottom,e},renderJsIgnore(){return(this.usePageScroll&&this.useChatRecordMode||!this.refresherEnabled||!this.useCustomRefresher)&&this.$nextTick((()=>{this.renderPropScrollTop=10})),0},windowHeight(){return this.systemInfo&&this.systemInfo.windowHeight||0},windowTop(){return this.systemInfo&&this.systemInfo.windowTop||0},windowBottom(){if(!this.systemInfo)return 0;let e=this.systemInfo.windowBottom||0;return this.safeAreaInsetBottom&&!this.useSafeAreaPlaceholder&&(e+=this.safeAreaBottom),e},isOldWebView(){try{const e=p.system.split(" "),t=e[0],i=parseInt(e[1].slice(0,1));if("iOS"===t&&i<=10||"Android"===t&&i<=6)return!0}catch(e){return!1}return!1},isIosAndH5:()=>!1},methods:{getVersion:()=>`z-paging v${zConstant.version}`,setSpecialEffects(e){this.setListSpecialEffects(e)},setListSpecialEffects(e){this.nFixFreezing=e&&Object.keys(e).length,this.isIos&&(this.privateRefresherEnabled=0),this.usePageScroll||this.$refs["zp-n-list"].setSpecialEffects(e)},_startLoading(e=!1){(this.showLoadingMoreWhenReload&&!this.isUserPullDown||!e)&&(this.loadingStatus=c.Enum.More.Loading),this.loading=!0},_doCheckScrollViewShouldFullHeight(e){this.autoFullHeight&&this.usePageScroll&&this.isTotalChangeFromAddData?this.$nextTick((()=>{this._checkScrollViewShouldFullHeight(((t,i)=>{this._preCheckShowLoadingMoreWhenNoMoreAndInsideOfPaging(e,t,i)}))})):this._preCheckShowLoadingMoreWhenNoMoreAndInsideOfPaging(e)},async _checkScrollViewShouldFullHeight(e){try{const t=await this._getNodeClientRect(".zp-scroll-view"),i=await this._getNodeClientRect(".zp-paging-container-content");if(!t||!i)return;const o=i[0].height,s=t[0].top;this.isAddedData&&o+s<=this.windowHeight?(this._setAutoHeight(!0,t),e(t,i)):(this._setAutoHeight(!1),e(null,null))}catch(t){e(null,null)}},async _setAutoHeight(e=!0,t=null){let i="height";this.usePageScroll&&(i="min-height");try{if(e){let e=t||await this._getNodeClientRect(".scroll-view"),s=await this._getNodeClientRect(".zp-page-bottom");if(e){const t=e[0].top;let n=this.windowHeight-t;s&&(n-=s[0].height);let a=o.u.convertTextToPx(this.autoHeightAddition);this.$set(this.scrollViewStyle,i,n+a-(this.insideMore?1:0)+"px"),this.$set(this.scrollViewInStyle,i,n+a-(this.insideMore?1:0)+"px")}}else this.$delete(this.scrollViewStyle,i),this.$delete(this.scrollViewInStyle,i)}catch(s){}},_getCssSafeAreaInsetBottom(){this._getNodeClientRect(".zp-safe-area-inset-bottom").then((e=>{e&&(this.cssSafeAreaInsetBottom=e[0].height,this.safeAreaInsetBottom&&this.updatePageScrollBottomHeight())}))},_updateInsideOfPaging(){this.insideMore&&!0===this.insideOfPaging&&setTimeout((()=>{this.doLoadMore()}),200)},_getNodeClientRect(t,i=!0,o=!1){let s=i?e.index.createSelectorQuery().in(this):e.index.createSelectorQuery();return o?s.select(t).scrollOffset():s.select(t).boundingClientRect(),new Promise(((e,t)=>{s.exec((t=>{e(!(!t||""==t||null==t||!t.length)&&t)}))}))},_cleanTimeout:e=>(e&&(clearTimeout(e),e=null),e),_onEmit(){e.index.$on(i.c.i18nUpdateKey,(()=>{this.tempLanguageUpdateKey=o.u.getTime()})),e.index.$on(i.c.errorUpdateKey,(()=>{this.loading&&this.complete(!1)})),e.index.$on(i.c.completeUpdateKey,(e=>{setTimeout((()=>{if(this.loading)if(this.disabledCompleteEmit)this.disabledCompleteEmit=!1;else{const t=e.type||"normal",i=e.list||e,o=e.rule;switch(this.fromCompleteEmit=!0,t){case"normal":this.complete(i);break;case"total":this.completeByTotal(i,o);break;case"nomore":this.completeByNoMore(i,o);break;case"key":this.completeByKey(i,o)}}}),1)}))},_offEmit(){e.index.$off(i.c.i18nUpdateKey),e.index.$off(i.c.errorUpdateKey),e.index.$off(i.c.completeUpdateKey)}}};exports._sfc_main=m;
