"use strict";var o=require("../z-paging-utils.js"),e=require("../z-paging-enum.js");const i={props:{loadingMoreCustomStyle:{type:Object,default:function(){return o.u.gc("loadingMoreCustomStyle",{})}},loadingMoreTitleCustomStyle:{type:Object,default:function(){return o.u.gc("loadingMoreTitleCustomStyle",{})}},loadingMoreLoadingIconCustomStyle:{type:Object,default:function(){return o.u.gc("loadingMoreLoadingIconCustomStyle",{})}},loadingMoreLoadingIconType:{type:String,default:o.u.gc("loadingMoreLoadingIconType","flower")},loadingMoreLoadingIconCustomImage:{type:String,default:o.u.gc("loadingMoreLoadingIconCustomImage","")},loadingMoreLoadingAnimated:{type:Boolean,default:o.u.gc("loadingMoreLoadingAnimated",!0)},loadingMoreEnabled:{type:Boolean,default:o.u.gc("loadingMoreEnabled",!0)},toBottomLoadingMoreEnabled:{type:Boolean,default:o.u.gc("toBottomLoadingMoreEnabled",!0)},loadingMoreDefaultAsLoading:{type:[Boolean],default:o.u.gc("loadingMoreDefaultAsLoading",!1)},loadingMoreDefaultText:{type:[String,Object],default:o.u.gc("loadingMoreDefaultText",null)},loadingMoreLoadingText:{type:[String,Object],default:o.u.gc("loadingMoreLoadingText",null)},loadingMoreNoMoreText:{type:[String,Object],default:o.u.gc("loadingMoreNoMoreText",null)},loadingMoreFailText:{type:[String,Object],default:o.u.gc("loadingMoreFailText",null)},hideLoadingMoreWhenNoMoreAndInsideOfPaging:{type:Boolean,default:o.u.gc("hideLoadingMoreWhenNoMoreAndInsideOfPaging",!1)},hideLoadingMoreWhenNoMoreByLimit:{type:Number,default:o.u.gc("hideLoadingMoreWhenNoMoreByLimit",0)},showDefaultLoadingMoreText:{type:Boolean,default:o.u.gc("showDefaultLoadingMoreText",!0)},showLoadingMoreNoMoreView:{type:Boolean,default:o.u.gc("showLoadingMoreNoMoreView",!0)},showLoadingMoreNoMoreLine:{type:Boolean,default:o.u.gc("showLoadingMoreNoMoreLine",!0)},loadingMoreNoMoreLineCustomStyle:{type:Object,default:function(){return o.u.gc("loadingMoreNoMoreLineCustomStyle",{})}},lowerThreshold:{type:[Number,String],default:o.u.gc("lowerThreshold","100rpx")}},data:()=>({loadingStatus:e.Enum.More.Default,loadingStatusAfterRender:e.Enum.More.Default,loadingMoreTimeStamp:0,loadingMoreDefaultSlot:null,showLoadingMore:!1,customNoMore:-1}),computed:{zPagingLoadMoreConfig(){return{status:this.loadingStatusAfterRender,defaultAsLoading:this.loadingMoreDefaultAsLoading,defaultThemeStyle:this.finalLoadingMoreThemeStyle,customStyle:this.loadingMoreCustomStyle,titleCustomStyle:this.loadingMoreTitleCustomStyle,iconCustomStyle:this.loadingMoreLoadingIconCustomStyle,loadingIconType:this.loadingMoreLoadingIconType,loadingIconCustomImage:this.loadingMoreLoadingIconCustomImage,loadingAnimated:this.loadingMoreLoadingAnimated,showNoMoreLine:this.showLoadingMoreNoMoreLine,noMoreLineCustomStyle:this.loadingMoreNoMoreLineCustomStyle,defaultText:this.finalLoadingMoreDefaultText,loadingText:this.finalLoadingMoreLoadingText,noMoreText:this.finalLoadingMoreNoMoreText,failText:this.finalLoadingMoreFailText,hideContent:!this.loadingMoreDefaultAsLoading&&this.listRendering}},finalLoadingMoreThemeStyle(){return this.loadingMoreThemeStyle.length?this.loadingMoreThemeStyle:this.defaultThemeStyle},showLoadingMoreDefault(){return this._showLoadingMore("Default")},showLoadingMoreLoading(){return this._showLoadingMore("Loading")},showLoadingMoreNoMore(){return this._showLoadingMore("NoMore")},showLoadingMoreFail(){return this._showLoadingMore("Fail")},showLoadingMoreCustom(){return this._showLoadingMore("Custom")}},methods:{doLoadMore(o){this._onLoadingMore(o)},_checkScrolledToBottom(o,e=!1){this.checkScrolledToBottomTimeOut&&(clearTimeout(this.checkScrolledToBottomTimeOut),this.checkScrolledToBottomTimeOut=null),-1===this.cacheScrollNodeHeight?this._getNodeClientRect(".zp-scroll-view").then((e=>{if(e){let i=e[0].height;this.cacheScrollNodeHeight=i,o-i<=this.finalLowerThreshold&&this._onLoadingMore("toBottom")}})):o-this.cacheScrollNodeHeight<=this.finalLowerThreshold?this._onLoadingMore("toBottom"):o-this.cacheScrollNodeHeight<=500&&!e&&(this.checkScrolledToBottomTimeOut=setTimeout((()=>{this._getNodeClientRect(".zp-scroll-view",!0,!0).then((o=>{this.oldScrollTop=o[0].scrollTop;const e=o[0].scrollHeight-this.oldScrollTop;this._checkScrolledToBottom(e,!0)}))}),150))},_onLoadingMore(i="click"){if("toBottom"===i&&(this.scrollToBottomBounceEnabled||this.scrollEnable&&(this.scrollEnable=!1,this.$nextTick((()=>{this.scrollEnable=!0})))),this.$emit("scrolltolower",i),("toBottom"!==i||this.toBottomLoadingMoreEnabled&&!this.useChatRecordMode)&&!(this.refresherOnly||!this.loadingMoreEnabled||this.loadingStatus!==e.Enum.More.Default&&this.loadingStatus!==e.Enum.More.Fail||this.loading)){if(!this.isIos&&!this.refresherOnly&&!this.usePageScroll){const e=o.u.getTime();if(this.loadingMoreTimeStamp>0&&e-this.loadingMoreTimeStamp<100)return void(this.loadingMoreTimeStamp=0)}this._doLoadingMore()}},_doLoadingMore(){this.pageNo>=this.defaultPageNo&&this.loadingStatus!==e.Enum.More.NoMore&&(this.pageNo++,this._startLoading(!1),this.isLocalPaging?this._localPagingQueryList(this.pageNo,this.defaultPageSize,this.localPagingLoadingTime,(o=>{this.addData(o)})):(this._emitQuery(this.pageNo,this.defaultPageSize,e.Enum.QueryFrom.LoadingMore),this._callMyParentQuery()),this.loadingType=e.Enum.LoadingType.LoadingMore)},_preCheckShowLoadingMoreWhenNoMoreAndInsideOfPaging(o,i,t){this.loadingStatus===e.Enum.More.NoMore&&this.hideLoadingMoreWhenNoMoreByLimit>0&&o.length?this.showLoadingMore=o.length>this.hideLoadingMoreWhenNoMoreByLimit:this.loadingStatus===e.Enum.More.NoMore&&this.hideLoadingMoreWhenNoMoreAndInsideOfPaging&&o.length||this.insideMore&&!1!==this.insideOfPaging&&o.length?(this.$nextTick((()=>{this._checkShowLoadingMoreWhenNoMoreAndInsideOfPaging(o,i,t)})),this.insideMore&&!1!==this.insideOfPaging&&o.length&&(this.showLoadingMore=o.length)):this.showLoadingMore=o.length},async _checkShowLoadingMoreWhenNoMoreAndInsideOfPaging(o,e,i){try{const o=e||await this._getNodeClientRect(".zp-scroll-view");if(this.usePageScroll){if(o){const e=o[0].top+o[0].height;this.insideOfPaging=e<this.windowHeight,this.hideLoadingMoreWhenNoMoreAndInsideOfPaging&&(this.showLoadingMore=!this.insideOfPaging),this._updateInsideOfPaging()}}else{let e=0,t=0;const n=i||await this._getNodeClientRect(".zp-paging-container-content");n&&(e=n[0].height),o&&(t=o[0].height),this.insideOfPaging=e<t,this.hideLoadingMoreWhenNoMoreAndInsideOfPaging&&(this.showLoadingMore=!this.insideOfPaging),this._updateInsideOfPaging()}}catch(t){this.insideOfPaging=!o.length,this.hideLoadingMoreWhenNoMoreAndInsideOfPaging&&(this.showLoadingMore=!this.insideOfPaging),this._updateInsideOfPaging()}},_showLoadingMore(o){if(!this.showLoadingMoreWhenReload&&(this.loadingStatus===e.Enum.More.Default&&!this.nShowBottom||!this.totalData.length))return!1;if((!this.showLoadingMoreWhenReload||this.isUserPullDown||this.loadingStatus!==e.Enum.More.Loading)&&!this.showLoadingMore||!this.loadingMoreEnabled&&(!this.showLoadingMoreWhenReload||this.isUserPullDown||this.loadingStatus!==e.Enum.More.Loading)||this.refresherOnly)return!1;if(this.useChatRecordMode&&"Loading"!==o)return!1;if(!this.$slots)return!1;if("Custom"===o)return this.showDefaultLoadingMoreText&&!(this.loadingStatus===e.Enum.More.NoMore&&!this.showLoadingMoreNoMoreView);return this.loadingStatus===e.Enum.More[o]&&this.$slots[`loadingMore${o}`]&&("NoMore"!==o||this.showLoadingMoreNoMoreView)}}};exports.ZPLoadMore=i;
