"use strict";var o=require("../../../../../../common/vendor.js"),l=require("../z-paging-utils.js"),t=require("../z-paging-enum.js");const e={props:{usePageScroll:{type:Boolean,default:l.u.gc("usePageScroll",!1)},scrollable:{type:Boolean,default:l.u.gc("scrollable",!0)},showScrollbar:{type:Boolean,default:l.u.gc("showScrollbar",!0)},scrollX:{type:Boolean,default:l.u.gc("scrollX",!1)},scrollToTopBounceEnabled:{type:Boolean,default:l.u.gc("scrollToTopBounceEnabled",!1)},scrollToBottomBounceEnabled:{type:Boolean,default:l.u.gc("scrollToBottomBounceEnabled",!0)},scrollWithAnimation:{type:Boolean,default:l.u.gc("scrollWithAnimation",!1)},scrollIntoView:{type:String,default:l.u.gc("scrollIntoView","")}},data:()=>({scrollTop:0,oldScrollTop:0,scrollViewStyle:{},scrollViewContainerStyle:{},scrollViewInStyle:{},pageScrollTop:-1,scrollEnable:!0,privateScrollWithAnimation:-1,cacheScrollNodeHeight:-1}),watch:{oldScrollTop(o,l){!this.usePageScroll&&this._scrollTopChange(o,l,!1)},pageScrollTop(o,l){this.usePageScroll&&this._scrollTopChange(o,l,!0)},usePageScroll:{handler(o){this.$nextTick((()=>{this.renderPropUsePageScroll=o})),this.loaded&&this.autoHeight&&this._setAutoHeight(!o)},immediate:!0},finalScrollTop(o,l){this.useChatRecordMode||(this.renderPropScrollTop=o<6?0:10)}},computed:{finalScrollWithAnimation(){if(-1!==this.privateScrollWithAnimation){const o=1===this.privateScrollWithAnimation;return this.privateScrollWithAnimation=-1,o}return this.scrollWithAnimation},finalScrollViewStyle(){return 1!=this.superContentZIndex&&(this.scrollViewStyle["z-index"]=this.superContentZIndex,this.scrollViewStyle.position="relative"),this.scrollViewStyle},finalScrollTop(){return this.usePageScroll?this.pageScrollTop:this.oldScrollTop},finalIsOldWebView(){return this.isOldWebView&&!this.usePageScroll}},methods:{scrollToTop(o,l=!0){this.$nextTick((()=>{this._scrollToTop(o,!1)}))},scrollToBottom(o,l=!0){this.$nextTick((()=>{this._scrollToBottom(o)}))},scrollIntoViewById(o,l,t){this._scrollIntoView(o,l,t)},scrollIntoViewByNodeTop(o,l,t){this.scrollTop=this.oldScrollTop,this.$nextTick((()=>{this._scrollIntoViewByNodeTop(o,l,t)}))},scrollToY(o,l,t){this.scrollTop=this.oldScrollTop,this.$nextTick((()=>{this._scrollToY(o,l,t)}))},scrollIntoViewByIndex(o,l,t){this._scrollIntoView(o,l,t)},scrollIntoViewByView(o,l,t){this._scrollIntoView(o,l,t)},updatePageScrollTop(o){null!=o?this.pageScrollTop=o:l.u.consoleErr("updatePageScrollTop方法缺少参数，请将页面onPageScroll事件中的scrollTop传递给此方法")},updatePageScrollTopHeight(){this._updatePageScrollTopOrBottomHeight("top")},updatePageScrollBottomHeight(){this._updatePageScrollTopOrBottomHeight("bottom")},updateScrollViewScrollTop(o,l=!0){this.privateScrollWithAnimation=l?1:0,this.scrollTop=this.oldScrollTop,this.$nextTick((()=>{this.scrollTop=o,this.oldScrollTop=this.scrollTop}))},_scrollToUpper(){this.$emit("scrolltoupper"),this.$emit("scrollTopChange",0),this.$nextTick((()=>{this.oldScrollTop=0})),this.useChatRecordMode&&this.loadingStatus!==t.Enum.More.NoMore&&this._onLoadingMore("click")},_scrollToTop(l=!0,t=!0){this.usePageScroll?this.$nextTick((()=>{o.index.pageScrollTo({scrollTop:0,duration:l?100:0})})):(this.privateScrollWithAnimation=l?1:0,this.scrollTop=this.oldScrollTop,this.$nextTick((()=>{this.scrollTop=0,this.oldScrollTop=this.scrollTop})))},async _scrollToBottom(l=!0){if(this.usePageScroll)this.$nextTick((()=>{o.index.pageScrollTo({scrollTop:Number.MAX_VALUE,duration:l?100:0})}));else try{this.privateScrollWithAnimation=l?1:0;let o=0,t=0;const e=await this._getNodeClientRect(".zp-paging-container"),i=await this._getNodeClientRect(".zp-scroll-view");e&&(o=e[0].height),i&&(t=i[0].height),o>t&&(this.scrollTop=this.oldScrollTop,this.$nextTick((()=>{this.scrollTop=o-t+this.virtualPlaceholderTopHeight,this.oldScrollTop=this.scrollTop})))}catch(t){}},_scrollIntoView(o,l=0,t=!1,e){try{this.scrollTop=this.oldScrollTop,this.$nextTick((()=>{-1!=o.indexOf("#")&&(o=o.replace("#","")),this._getNodeClientRect("#"+o,!1).then((o=>{if(o){let i=o[0].top;this._scrollIntoViewByNodeTop(i,l,t),e&&e()}}))}))}catch(i){}},_scrollIntoViewByNodeTop(o,l=0,t=!1){this._scrollToY(o,l,t,!0)},_scrollToY(l,t=0,e=!1,i=!1){this.privateScrollWithAnimation=e?1:0,this.usePageScroll?o.index.pageScrollTo({scrollTop:l-t,duration:e?100:0}):(i&&(l+=this.oldScrollTop),this.scrollTop=l-t,this.oldScrollTop=this.scrollTop)},_scroll(o){this.$emit("scroll",o);const l=o.detail.scrollTop;this.finalUseVirtualList&&this._updateVirtualScroll(l,this.oldScrollTop-l),this.oldScrollTop=l;const t=o.detail.scrollHeight-this.oldScrollTop;!this.isIos&&this._checkScrolledToBottom(t)},_scrollTopChange(o,l,t){this.$emit("scrollTopChange",o),this.$emit("update:scrollTop",o),this._checkShouldShowBackToTop(o,l);const e=this.isIos?o>5?6:0:o;t?this.wxsPageScrollTop=e:this.wxsScrollTop=e},_updatePageScrollTopOrBottomHeight(o){if(!this.usePageScroll)return;this._doCheckScrollViewShouldFullHeight(this.realTotalData);const l=`.zp-page-${o}`,t=`margin${o.slice(0,1).toUpperCase()+o.slice(1)}`;let e=this.safeAreaInsetBottom;this.$nextTick((()=>{setTimeout((()=>{this._getNodeClientRect(l).then((l=>{if(l){let i=l[0].height;"bottom"===o?e&&(i+=this.safeAreaBottom):this.cacheTopHeight=i,this.$set(this.scrollViewStyle,t,`${i}px`)}else e&&this.$set(this.scrollViewStyle,t,`${this.safeAreaBottom}px`)}))}),0)}))},_updateLeftAndRightWidth(){this.finalIsOldWebView&&this.$nextTick((()=>{setTimeout((()=>{this._getNodeClientRect(".zp-page-left").then((o=>{this.scrollViewContainerStyle.left=o?o[0].width+"px":0})),this._getNodeClientRect(".zp-page-right").then((o=>{this.scrollViewContainerStyle.right=o?o[0].width+"px":0}))}),0)}))},_updateRenderJsData(){this.renderPropUsePageScroll=-1,this.renderPropUsePageScroll=this.usePageScroll,this.useChatRecordMode||(this.renderPropScrollTop=-1,this.renderPropScrollTop=this.finalScrollTop<6?0:10)}}};exports.ZPScroller=e;
