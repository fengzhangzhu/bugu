"use strict";var e=require("../../common/vendor.js"),t=require("./service.js"),s=require("./storage.js"),a=require("./storageKeys.js"),n=require("../../common/requestFunctions.js"),r=require("../../common/constants.js");exports.getAndHandOfficialNewsList=async function(n){let r=await t.getUnReadOfficialNews(),i=await s.getOfficalList(n),o=[];i.forEach(((e,t)=>{let s=!1;for(let a=0;a<r.length;a++)if(r[a].type==e.type){s=!0;break}s||o.push(e)}));let l=a.getOfficeNewsListKey(n);return o=o.concat(r),await e.index.setStorage({key:l,data:o}),o},exports.getAndHandleInteractiveMessageList=async function(e){let a=0,n=await t.getUnReadInteractiveMessage();console.log("unreads",n);let i=[],o=[],l=[],u=[];for(let t of n)s.likeGroup.includes(t.type)?i.push(t):s.commentGroup.includes(t.type)?o.push(t):t.type===r.InteractiveType.ATTENTION?l.push(t):t.type===r.InteractiveType.PUBLISH&&u.push(t);return s.saveInteractiveMessageList(i,e,"LIKE"),s.saveInteractiveMessageList(o,e,"COMMENT"),s.saveInteractiveMessageList(l,e,"ATTENTION"),s.saveInteractiveMessageList(u,e,"PUBLISH"),a=i.length+o.length+l.length+u.length,a},exports.getAndHandleUserMessageList=async function(r){let i=await t.getUnReadUser();console.log("unReadList",i);let o=[],l=[];(await s.getUserMessageList(r)).forEach((e=>{let t=!1;for(let s=0;s<i.length;s++)if(i[s].userId==e.userId){t=!0;break}t||(o.push(e.userId),l.push(e))}));let u=await n.updateUserInfo(o);for(let e=0;e<u.length;e++)if(u[e].id==l[e].userId)l[e].avatar=u[e].avatar,l[e].username=u[e].username,l[e].online=u[e].online;else for(let t=0;t<l.length;t++)if(u[e].id==l[t].userId){l[t].avatar=u[e].avatar,l[t].username=u[e].username,l[t].online=u[e].online;break}l=l.concat(i),console.log("userMessageList",l);let c=a.getUserMessageListKey(r);return e.index.setStorage({key:c,data:l}),l};
