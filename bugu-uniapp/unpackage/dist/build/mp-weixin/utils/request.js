"use strict";var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,s=require("../common/vendor.js"),c=require("../common/constants.js");exports.getWeatherInfo=async function(e,t){return new Promise(((n,o)=>{s.index.request({method:"GET",url:"https://living.hbut.edu.cn/living/weather/now",data:{latitude:e,longitude:t},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){n(e)},fail:function(e){console.log("error in..."),o(e)}})}))},exports.request=async function(e){let l="";try{l=s.index.getStorageSync("token")}catch{}l||console.log("未登錄");let d=c.random16String(),u=c.timestamp,h=(f=((e,t)=>{for(var n in t||(t={}))a.call(t,n)&&r(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&r(e,n,t[n]);return e})({},e.data.header),p={t:u,r:d,s:s.md5(u+d+c.key),token:l},t(f,n(p)));var f,p;return new Promise(((t,n)=>{s.index.request({method:e.data.method,url:`${c.Protocol}://${c.ServerDomain}${e.data.modular?"/"+e.data.modular:""}/living/${e.data.group}/${e.data.action}`,data:e.data.data,header:h,success:function(e){t(e);let n=e.data,o=n.code,a=n.userMsg;if(o!=c.REQUEST_SUCCEEDED_CODE)if(console.log(e.data),"A0001"===o||"A0005"===o)s.index.showToast({title:"登录过期，请重新登录",icon:"none"});else{if("用户未认证,请先认证"===e.data.data)return s.index.showModal({title:"未实名认证",content:"发布内容需要实名认证哦~",success:function(e){e.confirm&&s.index.navigateTo({url:"/pages/setting/setting?open_real_name_authentication=true"})}}),e;if("用户未认证,请先认证"==n.errMsg)return s.index.showModal({title:"未实名认证",content:"发布内容需要实名认证哦~",success:function(e){e.confirm&&s.index.navigateTo({url:"/pages/setting/setting?open_real_name_authentication=true"})}}),e;s.index.showToast({title:a||"网络异常",icon:"none"})}return e},fail:function(e){console.log("error in..."),function(e){if(e&&e.response)switch(e.response.status){case 400:s.index.showToast({title:e.response.data.error.details,icon:"none"});break;case 401:s.index.showToast({title:"未授权，请登录",icon:"none"});break;case 403:s.index.showToast({title:"拒绝访问",icon:"none"});break;case 404:s.index.showToast({title:"请求地址出错",icon:"none"});break;case 408:s.index.showToast({title:"请求超时",icon:"none"});break;case 500:s.index.showToast({title:"服务器内部错误",icon:"none"});break;case 501:s.index.showToast({title:"服务未实现",icon:"none"});break;case 502:s.index.showToast({title:"网关错误",icon:"none"});break;case 503:s.index.showToast({title:"服务不可用",icon:"none"});break;case 504:s.index.showToast({title:"网关超时",icon:"none"});break;case 505:s.index.showToast({title:"HTTP版本不受支持",icon:"none"})}}(e),n(e)}})}))};
