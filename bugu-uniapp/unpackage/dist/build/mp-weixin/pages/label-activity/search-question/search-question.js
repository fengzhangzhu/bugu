"use strict";var e=require("../../../common/vendor.js"),t=require("../../../services/questionServices.js"),o=require("../../../common/storageKeys.js"),i=require("../../../common/storageFunctions.js"),s=require("../../../utils/request.js"),n=require("../../../common/constants.js");const a={data:()=>({searchText:"",searchTextBefore:"",haveMoreData:!1,questions:[],showBottomLoading:!1,page:1,editQuestionItem:{},scrollInto:"",hotLabels:[],showHotLabels:!0,searchHistory:[],myId:-1}),async onLoad(){this.hotLabels=await this.getHotLabels();let t=await i.getMyUserInfo();t&&(this.myId=t.id);let s=e.index.getStorageSync(o.SEARCH_QUESTION_HISTORY);s&&(this.searchHistory=s)},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onLabelTextClick(e){this.page=1,this.searchTextBefore=this.searchText=e,this.searchQuestions(this.searchText,this.page)},onScrolltolower(){this.haveMoreData&&(this.page=this.page+1,this.searchText!==this.searchTextBefore?this.searchQuestions(this.searchTextBefore,this.page):this.searchQuestions(this.searchText,this.page))},onSearchInput(e){this.searchText=e},onSearchConfirm(){this.searchText.length<1?e.index.showToast({title:"请先输入关键词"}):(this.page=1,e.index.showLoading({title:"搜索中"}),this.searchTextBefore=this.searchText,this.searchQuestions(this.searchText,this.page))},onQuestionItemClick(t){e.index.navigateTo({url:`/pages/activity-info/question-info/question-info?questionId=${t}`})},onQuestionItemMoreClick(e){this.editQuestionItem=e,this.$refs.questionActionPopup.open()},async onQuestionCollect(o){if(await t.collectQuestion(o)){let t=this.questions;for(let e=0;e<t.length;e++)if(t[e].id==o){t[e].isCollected=1,t[e].collectSum=t[e].collectSum+1;break}this.questions=t,this.$refs.questionActionPopup.close(),e.index.showToast({title:"收藏成功",icon:"success"})}else e.index.showToast({title:"收藏失败",icon:"error"})},async onCancelQuestionCollect(o){if(await t.cancelCollectQuestion(o)){let t=this.questions;for(let e=0;e<t.length;e++)if(t[e].id==o){t[e].isCollected=0,t[e].collectSum=t[e].collectSum-1;break}this.questions=t,this.$refs.questionActionPopup.close(),e.index.showToast({title:"取消成功",icon:"success"})}else e.index.showToast({title:"取消失败",icon:"error"})},onQuestionDeleteClick(o){let i=this;e.index.showModal({title:"删除问题",content:"你确定要删除这个问题吗",success:async function(s){if(s.confirm)if(await t.deleteQuestion(o)){let t=i.questions;for(let e=0;e<t.length;e++)if(t[e].id==o){t.splice(e,1);break}i.questions=t,i.$refs.questionActionPopup.close(),e.index.showToast({title:"删除成功",icon:"success"})}else e.index.showToast({title:"删除失败",icon:"error"})}})},async getHotLabels(){let e=await s.request({data:{method:"GET",group:"question",action:"label/list",data:{page:1},header:{"content-type":"application/x-www-form-urlencoded"}}});if(e.data.code===n.REQUEST_SUCCEEDED_CODE){return e.data.data.list}return[]},async searchQuestions(t,i){let a=await s.request({data:{method:"GET",group:"question",action:"fullTextQuery",data:{page:i,subText:t},header:{"content-type":"application/x-www-form-urlencoded"}}});if(a.data.code===n.REQUEST_SUCCEEDED_CODE){let e=a.data.data,o=e.list;if(o.length<1&&e.hasNext)return void(e.hasNext&&(this.page=i+1,this.searchQuestions(t,this.page)));if(e.hasNext?this.haveMoreData=!0:this.haveMoreData=!1,1===i)this.questions=o,this.scrollInto="";else{let e=this.questions.concat(o);this.questions=e}}if(e.index.hideLoading(),this.showHotLabels=!1,1==i){let i=[],s=e.index.getStorageSync(o.SEARCH_QUESTION_HISTORY);s&&(i=s),-1==i.indexOf(t)?(i.push(t),i.length>10&&i.splice(0,1)):(i.splice(i.indexOf(t),1),i.push(t)),e.index.setStorage({key:o.SEARCH_QUESTION_HISTORY,data:i}),this.searchHistory=i.reverse()}}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("uni-search-bar")+e.resolveComponent("question-item")+e.resolveComponent("uni-load-more")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../../components/question-item/question-item.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../../components/action-sheet/action-sheet.js"))();var r=e._export_sfc(a,[["render",function(t,o,i,s,n,a){return e.e({a:e.o((e=>a.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:e.o((e=>a.onSearchConfirm())),d:e.o((e=>n.searchText=e)),e:e.p({placeholder:"问题搜索",cancelButton:"none",modelValue:n.searchText}),f:e.o((e=>a.onSearchConfirm())),g:n.showHotLabels},n.showHotLabels?e.e({h:n.searchHistory.length>0},n.searchHistory.length>0?{i:e.f(n.searchHistory,((t,o,i)=>({a:e.t(t),b:t,c:e.o((e=>a.onLabelTextClick(t)),t)})))}:{},{j:e.f(n.hotLabels,((t,o,i)=>({a:e.t(o+1),b:e.n(o<3?"label-index-hot":"label-index"),c:e.t(t.content),d:e.t(t.hot),e:t.id,f:e.o((e=>a.onLabelTextClick(t.content)),t.id)})))}):e.e({k:e.f(n.questions,((t,o,i)=>({a:"question"+t.id,b:e.o((e=>a.onQuestionItemClick(t.id)),"question"+t.id),c:e.o((e=>a.onQuestionItemMoreClick(t)),"question"+t.id),d:"f9981302-2-"+i,e:e.p({questionData:t,answerData:t.hotAnswer})}))),l:n.questions.length<=0},n.questions.length<=0?{}:{m:e.p({status:n.haveMoreData?n.showBottomLoading?"loading":"more":"noMore",contentText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},iconType:"circle"})},{n:n.scrollInto,o:e.o(((...e)=>a.onScrolltolower&&a.onScrolltolower(...e)))}),{p:n.editQuestionItem.id},n.editQuestionItem.id?e.e({q:n.editQuestionItem.publisher&&n.editQuestionItem.publisher.id==n.myId},n.editQuestionItem.publisher&&n.editQuestionItem.publisher.id==n.myId?{r:e.o((e=>a.onQuestionDeleteClick(n.editQuestionItem.id))),s:e.p({icon:"icon-delete",title:"删除"})}:e.e({t:e.o((e=>t.onQuestionReportClick(n.editQuestionItem.id))),v:e.p({icon:"icon-alert",title:"举报"}),w:n.editQuestionItem.isCollected},n.editQuestionItem.isCollected?{x:e.o((e=>a.onCancelQuestionCollect(n.editQuestionItem.id))),y:e.p({icon:"icon-quxiaoguanzhu",title:"取消收藏"})}:{z:e.o((e=>a.onQuestionCollect(n.editQuestionItem.id))),A:e.p({icon:"icon-guanzhu",title:"收藏问题"})})):{},{B:e.sr("questionActionPopup","f9981302-4"),C:e.p({needHead:!0,title:"问题选择",needCancelButton:!0})})}]]);wx.createPage(r);
