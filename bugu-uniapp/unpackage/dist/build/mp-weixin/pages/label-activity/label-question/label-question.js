"use strict";var e=require("../../../common/vendor.js"),t=require("../../../services/questionServices.js"),o=require("../../../common/storageFunctions.js"),i=require("../../../utils/request.js"),n=require("../../../common/constants.js");require("../../../common/storageKeys.js");const s={data:()=>({labelText:"",labelId:0,isLoading:!0,haveMoreData:!1,questions:[],showBottomLoading:!1,page:1,editQuestionItem:{},scrollInto:"",myId:-1}),async onLoad(e){this.labelContent=e.labelContent,this.labelId=e.labelId;let t=await o.getMyUserInfo();t&&(this.myId=t.id),this.labelId&&await this.getQuestionsBylabelId(this.labelId,this.page),this.isLoading=!1},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onJoinButtonClick(){e.index.navigateTo({url:`/pages/publish/ask-questions/ask-questions?labelId=${this.labelId}&labelContent=${this.labelContent}`})},onScrolltolower(){this.haveMoreData&&(this.page=this.page+1,this.getQuestionsBylabelId(this.labelId,this.page))},onQuestionItemClick(t){e.index.navigateTo({url:`/pages/activity-info/question-info/question-info?questionId=${t}`})},onQuestionItemMoreClick(e){this.editQuestionItem=e,this.$refs.questionActionPopup.open()},async onQuestionCollect(o){if(await t.collectQuestion(o)){let t=this.questions;for(let e=0;e<t.length;e++)if(t[e].id==o){t[e].isCollected=1,t[e].collectSum=t[e].collectSum+1;break}this.questions=t,this.$refs.questionActionPopup.close(),e.index.showToast({title:"收藏成功",icon:"success"})}else e.index.showToast({title:"收藏失败",icon:"error"})},async onCancelQuestionCollect(o){if(await t.cancelCollectQuestion(o)){let t=this.questions;for(let e=0;e<t.length;e++)if(t[e].id==o){t[e].isCollected=0,t[e].collectSum=t[e].collectSum-1;break}this.questions=t,this.$refs.questionActionPopup.close(),e.index.showToast({title:"取消成功",icon:"success"})}else e.index.showToast({title:"取消失败",icon:"error"})},onQuestionDeleteClick(o){let i=this;e.index.showModal({title:"删除问题",content:"你确定要删除这个问题吗",success:async function(n){if(n.confirm)if(await t.deleteQuestion(o)){let t=i.questions;for(let e=0;e<t.length;e++)if(t[e].id==o){t.splice(e,1);break}i.questions=t,i.$refs.questionActionPopup.close(),e.index.showToast({title:"删除成功",icon:"success"})}else e.index.showToast({title:"删除失败",icon:"error"})}})},async getQuestionsBylabelId(e,t){let o=await i.request({data:{method:"GET",group:"question",action:"groupByLabel",data:{labelId:e,page:t},header:{"content-type":"application/x-www-form-urlencoded"}}});if(o.data.code===n.REQUEST_SUCCEEDED_CODE){let i=o.data.data,n=i.list;if(n.length<1&&i.hasNext)return void(i.hasNext&&(this.page=t+1,this.getQuestionsBylabelId(e,this.page)));if(i.hasNext?this.haveMoreData=!0:this.haveMoreData=!1,1===t)this.questions=n,this.scrollInto="";else{let e=this.questions.concat(n);this.questions=e}}}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("question-item-skeleton")+e.resolveComponent("question-item")+e.resolveComponent("uni-load-more")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../components/question-item-skeleton/question-item-skeleton.js")+(()=>"../../../components/question-item/question-item.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../../components/action-sheet/action-sheet.js"))();var l=e._export_sfc(s,[["render",function(t,o,i,n,s,l){return e.e({a:e.t(s.labelText),b:e.o((e=>l.onNarLeftClick())),c:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),d:e.t(t.labelContent),e:e.o((e=>l.onJoinButtonClick())),f:e.t(s.questions.length),g:s.isLoading},s.isLoading?{h:e.f([...new Array(5)],((e,t,o)=>({a:"skeleton"+t,b:"57605072-1-"+o}))),i:e.p({needLabel:!1})}:e.e({j:e.f(s.questions,((t,o,i)=>({a:"question"+t.id,b:e.o((e=>l.onQuestionItemClick(t.id)),"question"+t.id),c:e.o((e=>l.onQuestionItemMoreClick(t)),"question"+t.id),d:"57605072-2-"+i,e:e.p({questionData:t,answerData:t.hotAnswer})}))),k:s.questions.length<=0},s.questions.length<=0?{}:{l:e.p({status:s.haveMoreData?s.showBottomLoading?"loading":"more":"noMore",contentText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},iconType:"circle"})},{m:s.scrollInto,n:e.o(((...e)=>l.onScrolltolower&&l.onScrolltolower(...e)))}),{o:s.editQuestionItem.id},s.editQuestionItem.id?e.e({p:s.editQuestionItem.publisher&&s.editQuestionItem.publisher.id==s.myId},s.editQuestionItem.publisher&&s.editQuestionItem.publisher.id==s.myId?{q:e.o((e=>l.onQuestionDeleteClick(s.editQuestionItem.id))),r:e.p({icon:"icon-delete",title:"删除"})}:e.e({s:e.o((e=>t.onQuestionReportClick(s.editQuestionItem.id))),t:e.p({icon:"icon-alert",title:"举报"}),v:s.editQuestionItem.isLike},s.editQuestionItem.isLike?{w:e.o((e=>l.onCancelQuestionCollect(s.editQuestionItem.id))),x:e.p({icon:"icon-quxiaoguanzhu",title:"取消关注"})}:{y:e.o((e=>l.onQuestionCollect(s.editQuestionItem.id))),z:e.p({icon:"icon-guanzhu",title:"关注问题"})})):{},{A:e.sr("questionActionPopup","57605072-4"),B:e.p({needHead:!0,title:"问题选择",needCancelButton:!0})})}]]);wx.createPage(l);
