"use strict";var e=require("../../common/vendor.js"),t=require("../../common/requestFunctions.js"),i=require("../../common/storageFunctions.js"),o=require("../../utils/request.js"),l=require("../../common/constants.js");require("../../common/storageKeys.js");const s={data:()=>({articleNumber:0,showBottomLoading:!1,isRefresh:!1,haveMoreData:!1,labelId:"",labelContent:"",articles:[],myId:0,editArticleItem:{},page:1}),async onLoad(e){this.labelId=e.labelId,this.labelContent=e.labelContent;let t=await i.getMyUserInfo();t&&(this.myId=t.id),this.getLabelArticles(this.labelId,this.page)},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onJoinButtonClick(){e.index.navigateTo({url:`/pages/publish/publish?labelId=${this.labelId}&labelContent=${this.labelContent}`})},onIsRefresh(){this.isRefresh=!0,this.page=1,this.getLabelArticles(this.labelId,this.page)},onScrolltolower(){this.haveMoreData&&(this.page=this.page+1,this.getLabelArticles(this.labelId,this.page))},onActivityItemClick(t){e.index.navigateTo({url:`/pages/activity-info/activity-info?activityId=${t.id}`})},onMoreClick(e){this.$refs.articleActionPopup.open(),this.editArticleItem=e},onPopupReportClick(t){e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${t.id}&objectType=${l.reportObjectType.activity}`}),this.$refs.articleActionPopup.close()},onPopupDeleteClick(i){let o=this;e.index.showModal({title:"删除动态",content:"你确定要删除这个动态吗",success:async function(l){if(l.confirm&&await t.deleteMyArticle(i.id)){let t=o.articles;for(let e=0;e<t.length;e++)if(t[e].id==i.id){t.splice(e,1);break}o.articles=t,o.$refs.articleActionPopup.close(),e.index.showToast({title:"删除成功",icon:"success"})}}})},async onCancelFollow(i){if(!i.publisher)return;let o=this;e.index.showModal({title:"取消关注",content:`你确定要取消关注${i.publisher.username}`,success:async function(l){if(l.confirm&&i.publisher&&await t.cancelAttention(i.publisher.id)){let t=o.articles;for(let e=0;e<t.length;e++)t[e].publisher&&t[e].publisher.id==i.publisher.id&&(t[e].publisher.isAttention=0);o.articles=t,o.$refs.articleActionPopup.close(),e.index.showToast({title:"取消关注",icon:"success"})}}})},async onFollow(i){if(!i.publisher)return;let o=this;if(await t.followUser(i.publisher.id)){let t=o.articles;for(let e=0;e<t.length;e++)t[e].publisher&&t[e].publisher.id==i.publisher.id&&(t[e].publisher.isAttention=1);o.articles=t,o.$refs.articleActionPopup.close(),e.index.showToast({title:"关注成功",icon:"success"})}},async getLabelArticles(t,i){let s=await o.request({data:{method:"GET",group:"activity",action:"groupByLabel",data:{page:i,labelId:t},header:{"content-type":"application/x-www-form-urlencoded"}}});if(setTimeout((()=>{this.isRefresh=!1}),700),s.data.code===l.REQUEST_SUCCEEDED_CODE){let o=s.data.data.pageSum;this.articleNumber=s.data.data.total;let l=s.data.data.list;if(this.haveMoreData=i<o,1===i)e.index.showToast({title:"刷新成功",icon:"none"}),this.articles=l,this.scrollInto="";else{let e=this.articles.concat(l);this.articles=e}l.length<1&&i<o&&(this.page=i+1,this.getLabelArticles(t,this.page))}}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("activity-item")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../components/activity-item/activity-item.js")+(()=>"../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../components/action-sheet/action-sheet.js"))();var n=e._export_sfc(s,[["render",function(t,i,o,l,s,n){return e.e({a:e.t(s.labelContent),b:e.o((e=>n.onNarLeftClick())),c:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),d:e.t(s.labelContent),e:e.o((e=>n.onJoinButtonClick())),f:e.t(s.articleNumber),g:e.f(s.articles,((t,i,o)=>({a:t.id,b:e.o((e=>n.onActivityItemClick(t)),t.id),c:e.o((e=>n.onFollow(t)),t.id),d:e.o((e=>n.onMoreClick(t)),t.id),e:"37769080-1-"+o,f:e.p({articleItem:t,isMe:t.publisher&&s.myId==t.publisher.id})}))),h:s.articles.length<0},s.articles.length<0?{}:e.e({i:s.showBottomLoading},s.showBottomLoading?{j:"30px",k:"#adadad"}:{l:e.t(s.haveMoreData?"上拉或点击加载更多":"没有更多内容了")}),{m:s.isRefresh,n:t.scrollInto,o:e.o((e=>n.onIsRefresh())),p:e.o(((...e)=>n.onScrolltolower&&n.onScrolltolower(...e))),q:s.editArticleItem.id},s.editArticleItem.id?e.e({r:s.editArticleItem.isAnonymity},s.editArticleItem.isAnonymity?{s:e.o((e=>n.onPopupReportClick(s.editArticleItem))),t:e.p({icon:"icon-alert",title:"举报"})}:e.e({v:s.editArticleItem.publisher.id==s.myId},s.editArticleItem.publisher.id==s.myId?{w:e.o(n.onPopupDeleteClick),x:e.p({icon:"icon-delete",title:"删除"})}:e.e({y:1==s.editArticleItem.publisher.isAttention},1==s.editArticleItem.publisher.isAttention?{z:e.o((e=>n.onCancelFollow(s.editArticleItem))),A:e.p({icon:"icon-quxiaoguanzhu",title:"取消关注"})}:{B:e.o((e=>n.onFollow(s.editArticleItem))),C:e.p({icon:"icon-guanzhu",title:"关注"})},{D:e.p({icon:"icon-message",title:"私聊"}),E:e.o((e=>n.onPopupReportClick(s.editArticleItem))),F:e.p({icon:"icon-alert",title:"举报"})}))):{},{G:e.sr("articleActionPopup","37769080-2"),H:e.p({needHead:!0,title:"动态选择",needCancelButton:!0})})}]]);wx.createPage(n);
