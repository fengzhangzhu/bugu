"use strict";var e=require("../../common/vendor.js"),t=require("../../common/constants.js"),i=require("../../common/requestFunctions.js"),o=require("../../common/storageKeys.js"),n=require("../../utils/request.js"),a=require("./service.js");const s={emits:["onRefreshing"],props:{scollerHeight:{type:Number,require:!0},refresherEnabled:{type:Boolean,require:!0},myId:{type:Number,require:!0}},data:()=>({isLoading:!1,data:[],editArticleItem:{},hotLabels:[],touchY:0}),async created(){this.isLoading=!0,this.RecommendedLabels=await a.getRecommendedLabels(),this.hotLabels=await i.getHotLabels(1)},methods:{onContentTouchStart(e){this.touchY=e.changedTouches[0].clientY},onContentTouchEnd(e){if(this.touchY-e.changedTouches[0].clientY>50){if(!this.haveMoreData||this.data.length>10)return;this.showBottomLoading=!0,this.page=this.page+1,this.getSquarearticles(this.page)}},onSearchBarClick(){e.index.navigateTo({url:"/pages/label-activity/search-activity"})},onRecommendedClick(t){e.index.navigateTo({url:`../../pages/label-activity/label-activity?labelId=${t.id}&labelContent=${t.content}`})},queryList(e,i){n.request({data:{method:"GET",group:"activity",action:"square",data:{page:e},header:{"content-type":"application/x-www-form-urlencoded"}}}).then((e=>{e.data.code===t.REQUEST_SUCCEEDED_CODE?this.$refs.squareActivityPaging.complete(e.data.data.list):this.$refs.squareActivityPaging.complete(!1),this.isLoading=!1}),(()=>{this.$refs.squareActivityPaging.complete(!1),this.isLoading=!1}))},async onFollow(t){if(!t.publisher)return;let o=this;if(await i.followUser(t.publisher.id)){let i=o.data;for(let e=0;e<i.length;e++)i[e].publisher&&i[e].publisher.id==t.publisher.id&&(i[e].publisher.isAttention=1);o.data=i,o.$refs.articleActionPopup.close(),e.index.showToast({title:"关注成功",icon:"success"})}},onMoreClick(e){this.$refs.articleActionPopup.open(),this.editArticleItem=e},onActivityItemClick(t){e.index.navigateTo({url:`/pages/activity-info/activity-info?activityId=${t.id}`})},onShareClick(e){this.editArticleItem=e},async onCancelFollow(t){if(!t.publisher)return;let o=this;e.index.showModal({title:"取消关注",content:`你确定要取消关注${t.publisher.username}`,success:async function(n){if(n.confirm&&t.publisher&&await i.cancelAttention(t.publisher.id)){let i=o.data;for(let e=0;e<i.length;e++)i[e].publisher&&i[e].publisher.id==t.publisher.id&&(i[e].publisher.isAttention=0);o.data=i,o.$refs.articleActionPopup.close(),e.index.showToast({title:"取消关注",icon:"success"})}}})},async onChatClick(t){t.publisher&&e.index.navigateTo({url:`/pages/message-secondary-page/chat-content/chat-content?fromUserId=${t.publisher.id}`})},onPopupReportClick(i){e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${i.id}&objectType=${t.reportObjectType.activity}`}),this.$refs.articleActionPopup.close()},onPopupDeleteClick(){let t=this;e.index.showModal({title:"删除动态",content:"你确定要删除这个动态吗",success:async function(o){if(o.confirm&&await i.deleteMyArticle(t.editArticleItem.id)){let i=t.data;for(let e=0;e<i.length;e++)if(i[e].id==t.editArticleItem.id){i.splice(e,1);break}t.data=i,t.$refs.articleActionPopup.close(),e.index.showToast({title:"删除成功",icon:"success"})}}})},async playRefreshDynamicSound(){let i=e.index.getStorageSync(o.REFRESH_DYNAMIC_SOUND);i||(i=t.RingingToneList[6]);const n=e.index.createInnerAudioContext();n.autoplay=!0,n.src=i.url}}};if(!Array){(e.resolveComponent("activity-skeleton")+e.resolveComponent("activity-item")+e.resolveComponent("z-paging")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../components/activity-skeleton/activity-skeleton.js")+(()=>"../../components/activity-item/activity-item.js")+(()=>"../../uni_modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../components/action-sheet/action-sheet.js"))();var c=e._export_sfc(s,[["render",function(t,i,o,n,a,s){return e.e({a:e.f(a.hotLabels,((t,i,o)=>({a:e.t(t.content),b:t.id}))),b:e.o((e=>s.onSearchBarClick())),c:e.f(t.RecommendedLabels,((t,i,o)=>({a:t.icon,b:e.t(t.content),c:"recommended-label"+i,d:e.o((e=>s.onRecommendedClick(t)),"recommended-label"+i)}))),d:a.isLoading},a.isLoading?{e:e.f([...new Array(5)],((e,t,i)=>({a:"5b8028ab-1-"+i+",5b8028ab-0",b:t})))}:{},{f:e.w((({item:t,index:i},n,a)=>({a:"activity-"+t.id,b:e.o((e=>s.onFollow(t))),c:e.o((e=>s.onMoreClick(t))),d:e.o((e=>s.onActivityItemClick(t))),e:e.o((e=>s.onShareClick(t))),f:"5b8028ab-2-"+a+",5b8028ab-0",g:e.p({articleItem:t,isMe:1!=t.isAnonymity&&o.myId==t.publisher.id}),h:a,i:n})),{name:"cell",path:"f",vueId:"5b8028ab-0"}),g:e.sr("squareActivityPaging","5b8028ab-0"),h:e.o(s.queryList),i:e.p({"default-page-size":5,"use-virtual-list":!0,"cell-height-mode":"dynamic"}),j:a.editArticleItem.id},a.editArticleItem.id?e.e({k:a.editArticleItem.isAnonymity},a.editArticleItem.isAnonymity?{l:e.o((e=>s.onPopupReportClick(a.editArticleItem))),m:e.p({icon:"icon-alert",title:"举报"})}:e.e({n:a.editArticleItem.publisher.id==o.myId},a.editArticleItem.publisher.id==o.myId?{o:e.o(s.onPopupDeleteClick),p:e.p({icon:"icon-delete",title:"删除"})}:e.e({q:1==a.editArticleItem.publisher.isAttention},1==a.editArticleItem.publisher.isAttention?{r:e.o((e=>s.onCancelFollow(a.editArticleItem))),s:e.p({icon:"icon-quxiaoguanzhu",title:"取消关注"})}:{t:e.o((e=>s.onFollow(a.editArticleItem))),v:e.p({icon:"icon-guanzhu",title:"关注"})},{w:e.o((e=>s.onChatClick(a.editArticleItem))),x:e.p({icon:"icon-message",title:"私聊"}),y:e.o((e=>s.onPopupReportClick(a.editArticleItem))),z:e.p({icon:"icon-alert",title:"举报"})}))):{},{A:e.sr("articleActionPopup","5b8028ab-3"),B:e.p({needHead:!0,title:"动态选择",needCancelButton:!0})})}]]);wx.createComponent(c);
