"use strict";var e=require("../../common/vendor.js"),t=require("../../common/storageFunctions.js"),i=require("../../store/index.js"),s=require("../../utils/socket.js"),n=require("../../utils/tabBarBadgeUtils.js");require("../../common/storageKeys.js"),require("../../store/modules/messageStore.js"),require("../../store/modules/socketStateStore.js"),require("../../common/constants.js"),require("../../utils/messageUtils/storage.js"),require("../../utils/messageUtils/storageKeys.js"),require("../../utils/dateUtils.js"),require("../../common/requestFunctions.js"),require("../../utils/request.js"),require("../../common/globalMsgKeys.js"),require("../../utils/messageUtils/index.js"),require("../../utils/messageUtils/service.js");const o={components:{questions:()=>"./questions.js",hotArticles:()=>"./hot-articles.js",squareActivity:()=>"./square-activity.js"},data:()=>({tabLabels:[{title:"推荐",badge:0},{title:"问答",badge:0},{title:"热榜",badge:0}],tabSelect:0,touchY:0,myId:0,state:i.store.state,refresherEnabled:!0,contentHeight:0,navHeight:0,isRefresh:!1}),async onLoad(i){let s=i.inviteCode;s&&e.index.setStorage({key:"BeInvitedCode",data:s});let o=await t.getMyUserInfo();if(!o)return this.isLoading=!1,void e.index.showModal({title:"未登录",content:"未登录，请先登录",success:function(t){t.confirm&&(e.index.setStorage({key:"token",data:null}),e.index.navigateTo({url:"/pages/login/login"}))}});this.myId=o.id,this.isLoading=!1,n.initUnreadMessageSum(o.id)},onReady(){let t=this;e.index.getSystemInfo({success(e){t.contentHeight=e.windowHeight}}),e.index.createSelectorQuery().select("#index-swiper").boundingClientRect((e=>{t.navHeight=e.top})).exec()},async onShow(){await t.getMyUserInfo()?this.state.socketStateStore.isConnectSocket||s.connectSocket():e.index.closeSocket()},computed:{newMessage(){return this.state.messageStore.newMessage},statusBarHeight:()=>e.index.getSystemInfoSync().statusBarHeight+"px",scollerHeight(){return this.contentHeight-this.navHeight}},watch:{newMessage:function(e){this.$refs.messagePopup.open()}},onShareAppMessage(){let e="";this.editArticleItem.pic.length>0&&(e=1==this.editArticleItem.video?this.editArticleItem.pic[0]+"?vframe/jpg/offset/0":this.editArticleItem.pic[0]);let t="";return 1==this.editArticleItem.isAnonymity?t="匿名用户":this.editArticleItem.publisher&&(t=this.editArticleItem.publisher.username),{title:`${t}发布了一条动态，快来看看ta说了什么`,path:`/pages/activity-info/activity-info?activityId=${this.editArticleItem.id}`,imageUrl:e}},methods:{onRefreshing(e){this.isRefresh=e},navigateTo(t){e.index.navigateTo({url:t})},onSwiperTransition(){this.isRefreshing||(this.refresherEnabled=!1)},onSwiperAnimationfinish(){this.refresherEnabled=!0},onPublishButtonClick(){e.index.navigateTo({url:"/pages/publish/publish"})},onAskQuestionButtonClick(){e.index.navigateTo({url:"/pages/publish/ask-questions/ask-questions"})},onSellGoodsButtonClick(){e.index.navigateTo({url:"/pages/publish/sell-goods/sell-goods"})},onSwiperChange(e){this.tabSelect=e.detail.current},onTabsClick(e){this.tabSelect=e}}};if(!Array){(e.resolveComponent("page-tabs")+e.resolveComponent("square-activity")+e.resolveComponent("questions")+e.resolveComponent("hot-articles"))()}Math;var r=e._export_sfc(o,[["render",function(t,i,s,n,o,r){return{a:e.o(r.onTabsClick),b:e.p({labels:o.tabLabels,index:o.tabSelect,tabPadding:26,activeFontSize:18,defaultFontSize:16,defaultColor:"#676767",underLineType:"bubble"}),c:r.statusBarHeight,d:e.o(((...e)=>r.onPublishButtonClick&&r.onPublishButtonClick(...e))),e:e.o(r.onRefreshing),f:e.p({scollerHeight:r.scollerHeight,refresherEnabled:o.refresherEnabled,myId:o.myId}),g:e.o(((...e)=>r.onAskQuestionButtonClick&&r.onAskQuestionButtonClick(...e))),h:e.o(r.onRefreshing),i:e.p({scollerHeight:r.scollerHeight,refresherEnabled:o.refresherEnabled,myId:o.myId}),j:e.o(r.onRefreshing),k:e.p({scollerHeight:r.scollerHeight,refresherEnabled:o.refresherEnabled,myId:o.myId}),l:o.tabSelect,m:r.scollerHeight+"px",n:e.o(((...e)=>r.onSwiperChange&&r.onSwiperChange(...e))),o:e.o(((...e)=>r.onSwiperTransition&&r.onSwiperTransition(...e))),p:e.o(((...e)=>r.onSwiperAnimationfinish&&r.onSwiperAnimationfinish(...e)))}}]]);o.__runtimeHooks=2,wx.createPage(r);
