"use strict";var e=require("../../../common/vendor.js"),a=require("../../../common/storageKeys.js"),t=require("../../../common/storageFunctions.js"),n=require("../../../common/requestFunctions.js"),o=require("../../../common/constants.js"),r=require("../../../utils/aes/export.js"),s=require("../../../utils/request.js"),i=require("../../../common/globalMsgKeys.js");const u={data:()=>({userId:0,username:"",avatar:"",sex:0,isVerify:0,sexGrounp:o.sexGrounp}),onLoad(){this.refreshUserInfo()},onShow(){let a=this;e.index.$once(i.REFRESH_USERINFO,(function(e){e.needRefresh&&a.refreshUserInfo()}))},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},async refreshUserInfo(){let o=await t.getMyUserInfo(),r=await n.getUserinfo(o.id);r&&(e.index.setStorage({key:a.USER_INFO,data:r}),this.id=r.id,this.username=r.username,this.avatar=r.avatar,this.sex=null==r.sex?-1:r.sex,this.isVerify=r.isVerify)},onChangeAvatarClick(){this.$refs.changeAvatarPopup.open()},onSexPickerChange(e){this.changeSex(e.detail.value)},onSeletImage(a){let t=this;e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:[a],success:function(e){var a=e.tempFilePaths;t.changeAvatar(a[0])}})},async changeAvatar(a){e.index.showLoading({title:"正在发布"});let t=await s.request({data:{method:"GET",group:"user",action:"avatar/token",data:{},header:{"content-type":"application/x-www-form-urlencoded"}}});if(t.data.code===o.REQUEST_SUCCEEDED_CODE){let n=t.data.data.fileName,u=t.data.data.token,c=this;e.index.uploadFile({url:o.UploadUrl,filePath:a,name:"file",formData:{key:n,token:r.aes.decrypt(u)},async success(a){(await s.request({data:{method:"POST",group:"user",action:"avatar/change",data:{fileName:n},header:{"content-type":"application/x-www-form-urlencoded"}}})).data.code===o.REQUEST_SUCCEEDED_CODE&&(e.index.showToast({title:"更换头像成功"}),c.$refs.changeAvatarPopup.close(),c.refreshUserInfo(),e.index.$emit(i.REFRESH_USERINFO,{needRefresh:!0}))}})}},async changeSex(a){e.index.showLoading({title:"修改中"}),(await s.request({data:{method:"POST",group:"user",action:"sex/update",data:{sex:a},header:{"content-type":"application/x-www-form-urlencoded"}}})).data.code===o.REQUEST_SUCCEEDED_CODE&&(e.index.showToast({title:"修改性别成功"}),this.refreshUserInfo(),e.index.$emit(i.REFRESH_USERINFO,{needRefresh:!0}))}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var c=e._export_sfc(u,[["render",function(a,t,n,o,r,s){return e.e({a:e.o((e=>s.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:e.o(s.onChangeAvatarClick),d:e.p({clickable:!0,thumb:r.avatar,thumbSize:"lg",showArrow:!0,rightText:"修改头像"}),e:e.p({clickable:!0,showArrow:!0,link:!0,to:`/pages/setting/personal_information/change-username?username=${r.username}`,title:"昵称",rightText:r.username}),f:e.p({clickable:!0,showArrow:!0,title:"性别",rightText:-1==r.sex?"未设置":r.sexGrounp[r.sex]}),g:r.sexGrounp,h:r.sex,i:e.o(((...e)=>s.onSexPickerChange&&s.onSexPickerChange(...e))),j:e.p({clickable:!0,showArrow:!0,title:"是否实名认证",rightText:1==r.isVerify?"已实名认证":"未实名认证"}),k:r.avatar},r.avatar?{l:r.avatar,m:e.o((e=>s.onSeletImage("camera"))),n:e.o((e=>s.onSeletImage("album")))}:{},{o:e.sr("changeAvatarPopup","87c768be-6"),p:e.p({type:"center"})})}]]);wx.createPage(c);
