"use strict";var e=require("../../../common/vendor.js"),t=require("../../../services/questionServices.js"),o=require("../../../common/storageFunctions.js"),i=require("../../../utils/request.js"),s=require("../../../common/constants.js");require("../../../common/storageKeys.js");const n={data:()=>({isLoading:!0,haveMoreData:!1,questions:[],showBottomLoading:!1,page:1,editQuestionItem:{},scrollInto:"",myId:-1}),async onLoad(){let e=await o.getMyUserInfo();e&&(this.myId=e.id),await this.getMyCollectedQuestions(this.page),this.isLoading=!1},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onScrolltolower(){this.haveMoreData&&(this.page=this.page+1,this.getMyCollectedQuestions(this.page))},onQuestionItemClick(t){e.index.navigateTo({url:`/pages/activity-info/question-info/question-info?questionId=${t}`})},onQuestionItemMoreClick(e){this.editQuestionItem=e,this.$refs.questionActionPopup.open()},onQuestionDeleteClick(o){let i=this;e.index.showModal({title:"删除问题",content:"你确定要删除这个问题吗",success:async function(s){if(s.confirm)if(await t.deleteQuestion(o)){let t=i.questions;for(let e=0;e<t.length;e++)if(t[e].issue.id==o){t.splice(e,1);break}i.questions=t,i.$refs.questionActionPopup.close(),e.index.showToast({title:"删除成功",icon:"success"})}else e.index.showToast({title:"删除失败",icon:"error"})}})},onQuestionReportClick(t){e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${t}&objectType=${s.reportObjectType.question}&modular=question`}),this.$refs.questionActionPopup.close()},async onQuestionCollect(o){if(await t.collectQuestion(o)){let t=this.questions;for(let e=0;e<t.length;e++)if(t[e].issue.id==o){t[e].isLike=1,t[e].issue.likeSum=t[e].issue.likeSum+1;break}this.questions=t,this.$refs.questionActionPopup.close(),e.index.showToast({title:"关注成功",icon:"success"})}else e.index.showToast({title:"关注失败",icon:"error"})},async onCancelQuestionCellect(o){if(await t.cancelCollectQuestion(o)){let t=this.questions;for(let e=0;e<t.length;e++)if(t[e].issue.id==o){t[e].isLike=0,t[e].issue.likeSum=t[e].issue.likeSum-1;break}this.questions=t,this.$refs.questionActionPopup.close(),e.index.showToast({title:"取消成功",icon:"success"})}else e.index.showToast({title:"取消失败",icon:"error"})},async getMyCollectedQuestions(t){let o=await i.request({data:{method:"GET",group:"question",action:"my/collected",data:{page:t},header:{"content-type":"application/x-www-form-urlencoded"}}});if(o.data.code===s.REQUEST_SUCCEEDED_CODE){let e=o.data.data,i=e.list;if(i.length<1&&e.hasNext&&(this.page=t+1,this.getMyCollectedQuestions(this.page)),e.hasNext?this.haveMoreData=!0:this.haveMoreData=!1,1===t)this.questions=i,this.scrollInto="";else{let e=this.questions.concat(i);this.questions=e}}e.index.hideLoading()}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("question-item-skeleton")+e.resolveComponent("question-item")+e.resolveComponent("uni-load-more")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../components/question-item-skeleton/question-item-skeleton.js")+(()=>"../../../components/question-item/question-item.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../../components/action-sheet/action-sheet.js"))();var a=e._export_sfc(n,[["render",function(t,o,i,s,n,a){return e.e({a:e.o((e=>a.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:n.isLoading},n.isLoading?{d:e.f([...new Array(5)],((e,t,o)=>({a:"skeleton"+t,b:"8c7f0a68-1-"+o}))),e:e.p({needLabel:!1})}:e.e({f:e.f(n.questions,((t,o,i)=>({a:"question"+t.id,b:e.o((e=>a.onQuestionItemClick(t.id)),"question"+t.id),c:e.o((e=>a.onQuestionItemMoreClick(t)),"question"+t.id),d:"8c7f0a68-2-"+i,e:e.p({questionData:t,answerData:t.hotAnswer})}))),g:n.questions.length<=0},n.questions.length<=0?{}:{h:e.p({status:n.haveMoreData?n.showBottomLoading?"loading":"more":"noMore",contentText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},iconType:"circle"})},{i:n.scrollInto,j:e.o(((...e)=>a.onScrolltolower&&a.onScrolltolower(...e)))}),{k:n.editQuestionItem.id},n.editQuestionItem.id?e.e({l:n.editQuestionItem.publisher&&n.editQuestionItem.publisher.id==n.myId},n.editQuestionItem.publisher&&n.editQuestionItem.publisher.id==n.myId?{m:e.o((e=>a.onQuestionDeleteClick(n.editQuestionItem.id))),n:e.p({icon:"icon-delete",title:"删除"})}:e.e({o:e.o((e=>a.onQuestionReportClick(n.editQuestionItem.id))),p:e.p({icon:"icon-alert",title:"举报"}),q:n.editQuestionItem.isCollected},n.editQuestionItem.isCollected?{r:e.o((e=>a.onCancelQuestionCellect(n.editQuestionItem.id))),s:e.p({icon:"icon-quxiaoguanzhu",title:"取消关注"})}:{t:e.o((e=>a.onQuestionCollect(n.editQuestionItem.id))),v:e.p({icon:"icon-guanzhu",title:"关注问题"})})):{},{w:e.sr("questionActionPopup","8c7f0a68-4"),x:e.p({needHead:!0,title:"问题选择",needCancelButton:!0})})}]]);wx.createPage(a);
