"use strict";var e=require("../../../common/vendor.js"),t=require("../../../utils/request.js"),o=require("../../../common/constants.js"),a=require("../../../common/storageFunctions.js"),n=require("../../../common/requestFunctions.js");require("../../../common/storageKeys.js");const i={data:()=>({boxSelected:0,femaleBoxSum:0,maleBoxSum:0,lastClickTime:0,boxTicketsAvailableSum:0,userInfo:{},boxInfo:{},boxOwnerInfo:{}}),async onLoad(){this.userInfo=await a.getMyUserInfo(),this.getBoxInfo(),this.getBoxTicketsInfo(1)},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onShowRulesButtonClick(){this.$refs.boxRulePopup.open()},onGetMoreTicketsClick(){e.index.showModal({title:"获取方法",content:"投入盲盒即可获取一张盲盒劵哦~"})},onPutBoxButtonClick(){2!=this.boxSelected?this.$refs.putboxPopup.open():e.index.navigateTo({url:"/pages/bugu-secondary-page/blind-box/my-box"})},onPutBoxConfirm(e){this.putBox(this.boxSelected,e)},onBoxTicketsButtonClick(){e.index.navigateTo({url:"/pages/bugu-secondary-page/blind-box/box-tickets"})},onBoxConfirmClick(t){e.index.navigateTo({url:`/pages/user-home-page/user-home-page?userId=${t}`})},async takeBox(a){if(this.userInfo.sex==a)return void e.index.showToast({title:"只能获取异性的盲盒哦",icon:"error"});let i=await t.request({data:{method:"GET",group:"blindBox",action:"collect",data:{sex:a},header:{"content-type":"application/x-www-form-urlencoded"}}});if(i.data.code===o.REQUEST_SUCCEEDED_CODE){let e=i.data.data,t=await n.getUserinfo(e.userId);this.boxInfo=e,this.boxOwnerInfo=t,this.getBoxInfo(),this.$refs.takeboxPopup.open()}else e.index.showModal({title:"获取失败",content:i.data.userMsg})},onBoxSelected(t){let o=Date.now();if(this.boxSelected==t){if(2==this.boxSelected)return void e.index.navigateTo({url:"/pages/bugu-secondary-page/blind-box/my-box"});if(o-this.lastClickTime<500)return;this.lastClickTime=o;let a=this;e.index.showModal({title:"抽取盲盒",content:`你确定要消耗一张盲盒劵抽取一个${0==t?"女":"男"}盒吗？`,success:function(e){e.confirm&&(a.takeBox(t),a.lastClickTime=o)}})}else this.boxSelected=t,this.lastClickTime=o},async putBox(a,n){(await t.request({data:{method:"PUT",group:"blindBox",action:"deliver",data:{sex:a,text:n},header:{"content-type":"application/x-www-form-urlencoded"}}})).data.code===o.REQUEST_SUCCEEDED_CODE&&(this.getBoxInfo(),e.index.showToast({title:"投送成功",icon:"success"}))},async getBoxInfo(){let e=await t.request({data:{method:"GET",group:"blindBox",action:"info",data:{},header:{"content-type":"application/x-www-form-urlencoded"}}});e.data.code===o.REQUEST_SUCCEEDED_CODE&&(this.femaleBoxSum=e.data.data.femaleBoxSum,this.maleBoxSum=e.data.data.maleBoxSum)},async getBoxTicketsInfo(e){let a=await t.request({data:{method:"GET",group:"blindBox",action:"ticket/list",data:{page:e},header:{"content-type":"application/x-www-form-urlencoded"}}});a.data.code===o.REQUEST_SUCCEEDED_CODE&&(this.boxTicketsAvailableSum=a.data.data.list.availableSum)}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var s=e._export_sfc(i,[["render",function(t,o,a,n,i,s){return e.e({a:e.o((e=>s.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:0==i.boxSelected?"#f0afc7":1==i.boxSelected?"#8fd5f1":"#f9e3ce",d:e.o((e=>s.onShowRulesButtonClick())),e:e.t(0==i.boxSelected?`当前有${i.femaleBoxSum}个女生盒子`:1==i.boxSelected?`当前有${i.maleBoxSum}个男生盒子`:"我收到和投入的盒子"),f:0==i.boxSelected?"#f0afc7":1==i.boxSelected?"#8fd5f1":"#f9e3ce",g:e.t(i.boxTicketsAvailableSum),h:0==i.boxSelected?"#f0afc7":1==i.boxSelected?"#8fd5f1":"#f9e3ce",i:e.o(((...e)=>s.onBoxTicketsButtonClick&&s.onBoxTicketsButtonClick(...e))),j:0==i.boxSelected?"/static/svgs/box-girl-selected.svg":"/static/svgs/box-girl.svg",k:0==i.boxSelected?"7px dotted #f0afc7":"7px dotted #ffffff00",l:e.o((e=>s.onBoxSelected(0))),m:1==i.boxSelected?"/static/svgs/box-boy-selected.svg":"/static/svgs/box-boy.svg",n:1==i.boxSelected?"7px dotted #8fd5f1":"7px dotted #ffffff00",o:e.o((e=>s.onBoxSelected(1))),p:2==i.boxSelected?"/static/svgs/box-me-selected.svg":"/static/svgs/box-me.svg",q:2==i.boxSelected?"7px dotted #f9e3ce":"7px dotted #ffffff00",r:e.o((e=>s.onBoxSelected(2))),s:0==i.boxSelected?"#f0afc7":1==i.boxSelected?"#8fd5f1":"#f9e3ce",t:e.o((e=>s.onGetMoreTicketsClick())),v:e.t(0==i.boxSelected?"留下女盒":1==i.boxSelected?"留下男盒":"我的盒子"),w:0==i.boxSelected?"#f0afc7":1==i.boxSelected?"#8fd5f1":"#f9e3ce",x:e.o((e=>s.onPutBoxButtonClick())),y:0==i.boxSelected?"linear-gradient(to bottom, #fcf5f7, #fff);":1==i.boxSelected?"linear-gradient(to bottom, #f1f5fc, #fff);":"linear-gradient(to bottom, #fefaf5, #fff);",z:i.boxOwnerInfo.username},i.boxOwnerInfo.username?{A:e.t(i.boxInfo.text),B:e.o((e=>s.onBoxConfirmClick(i.boxOwnerInfo.id))),C:e.p({title:`来自${i.boxOwnerInfo.username}的盒子`,customOkText:"和ta打声招呼",customCancelText:"再等一会儿"})}:{},{D:e.sr("takeboxPopup","d83217a6-1"),E:e.p({type:"dialog"}),F:e.o(s.onPutBoxConfirm),G:e.p({mode:"input",title:"投放盲盒",placeholder:"介绍一下自己吧"}),H:e.sr("putboxPopup","d83217a6-3"),I:e.p({type:"dialog"}),J:e.t("\n\t\t\t\t\t\t1.点击盒子切换类型，再次点击抽取一个盲盒\n\t\t\t\t\t\t2.投入盲盒可以获取一张盲盒劵，每周上限两张\n\t\t\t\t\t\t3.抽取盲盒需要消耗一张盲盒劵哦~\n\t\t\t\t\t\t4.一天只能抽取和投入一个盲盒哦~\n\t\t\t\t\t\t"),K:e.p({title:"盲盒规则介绍",customCancelText:"我知道了"}),L:e.sr("boxRulePopup","d83217a6-5"),M:e.p({type:"dialog"})})}]]);wx.createPage(s);
