"use strict";var e=require("../../common/vendor.js"),o=require("../../utils/request.js"),n=require("../../common/constants.js"),a=require("../../common/globalMsgKeys.js");const t={data:()=>({username:"",password:"",agreest:!1,MainColor:n.MainColor}),methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onCheckBoxClick(){this.agreest=!this.agreest},onPasswordInput(e){this.password=e},onUsernameInput(e){this.username=e},onUserProtocolClick(){e.index.navigateTo({url:"/pages/login/bugu-use-protocol/bugu-use-protocol"})},onPrivacyPolicyClick(){e.index.navigateTo({url:"/pages/login/bugu-privacy-policy/bugu-privacy-policy"})},onLoginButtonClick(){this.username&&this.password?this.agreest?this.tryToLogin(this.username,this.password):e.index.showToast({title:"请先同意用户协议和隐私政策",icon:"none"}):e.index.showToast({title:"请先输入用户名或密码",icon:"none"})},async tryToLogin(t,i){e.index.showLoading({title:"正在登陆"});try{let s=await o.request({data:{method:"POST",group:"user",action:"login/byPassword",data:{username:t,password:i},header:{"content-type":"application/x-www-form-urlencoded"}}});e.index.hideLoading(),s.data.code===n.REQUEST_SUCCEEDED_CODE&&(await e.index.setStorage({key:"token",data:s.data.data.token}),await e.index.setStorage({key:"userInfo",data:s.data.data.userInfo}),e.index.showToast({title:"登录成功",icon:"success"}),e.index.$emit(a.REFRESH_USERINFO,{needRefresh:!0}),e.index.navigateBack({delta:2}))}catch{e.index.showToast({title:"登录失败，请稍后再试",icon:"none"})}}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();var i=e._export_sfc(t,[["render",function(o,n,a,t,i,s){return{a:e.o((e=>s.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:e.o(s.onUsernameInput),d:e.p({value:i.username,type:"text",placeholder:"请输入用户名"}),e:e.p({required:"true",label:"用户名",name:"username"}),f:e.o(s.onPasswordInput),g:e.p({value:i.password,type:"password",placeholder:"请输入密码"}),h:e.p({required:"true",label:"密码",name:"password"}),i:i.MainColor,j:e.o((e=>s.onCheckBoxClick())),k:i.agreest,l:e.o(((...e)=>s.onUserProtocolClick&&s.onUserProtocolClick(...e))),m:e.o(((...e)=>s.onPrivacyPolicyClick&&s.onPrivacyPolicyClick(...e))),n:e.o((e=>s.onLoginButtonClick()))}}]]);wx.createPage(i);
