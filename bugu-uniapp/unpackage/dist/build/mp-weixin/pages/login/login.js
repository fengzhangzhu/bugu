"use strict";var o=require("../../common/vendor.js"),e=require("../../utils/request.js"),i=require("../../common/constants.js"),t=require("../../common/globalMsgKeys.js");const n={data:()=>({isLoading:!1,agreest:!1,MainColor:i.MainColor}),methods:{onNarLeftClick(){o.index.navigateBack({delta:1})},onOtherLoginTextClick(){o.index.navigateTo({url:"./account-login"})},onCheckBoxClick(){this.agreest=!this.agreest},onUserProtocolClick(){o.index.navigateTo({url:"/pages/login/bugu-use-protocol/bugu-use-protocol"})},onPrivacyPolicyClick(){o.index.navigateTo({url:"/pages/login/bugu-privacy-policy/bugu-privacy-policy"})},onLoginButtonClidk(){if(!this.isLoading)if(this.agreest){let e=this;o.index.login({provider:"weixin",success:function(i){if(i.code){e.code=i.code;try{let t=o.index.getStorageSync("BeInvitedCode");e.tryToLogin(i.code,t),o.index.setStorage({key:"BeInvitedCode",data:null})}catch{e.tryToLogin(i.code)}}}})}else o.index.showToast({title:"请先同意《用户协议》和《隐私政策》",icon:"none"})},async tryToLogin(n,a){o.index.showLoading({title:"正在登陆"}),this.isLoading=!0;try{let r=await e.request({data:{method:"GET",group:"user",action:"login",data:a?{inviteCode:a,code:n}:{code:n},header:{"content-type":"application/x-www-form-urlencoded"}}});this.isLoading=!1,r.data.code===i.REQUEST_SUCCEEDED_CODE&&(await o.index.setStorage({key:"token",data:r.data.data.token}),await o.index.setStorage({key:"userInfo",data:r.data.data.userInfo}),o.index.showToast({title:"登录成功",icon:"success"}),o.index.$emit(t.REFRESH_USERINFO,{needRefresh:!0}),o.index.navigateBack({}))}catch{o.index.showToast({title:"登录失败，请稍后再试",icon:"none"})}}}};if(!Array){o.resolveComponent("uni-nav-bar")()}Math;var a=o._export_sfc(n,[["render",function(e,i,t,n,a,r){return{a:o.o((o=>r.onNarLeftClick())),b:o.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:o.t(a.isLoading?"正在登陆":"微信一键登录"),d:o.o((o=>r.onLoginButtonClidk())),e:o.o((o=>r.onOtherLoginTextClick())),f:a.MainColor,g:o.o((o=>r.onCheckBoxClick())),h:a.agreest,i:o.o(((...o)=>r.onUserProtocolClick&&r.onUserProtocolClick(...o))),j:o.o(((...o)=>r.onPrivacyPolicyClick&&r.onPrivacyPolicyClick(...o)))}}]]);wx.createPage(a);
