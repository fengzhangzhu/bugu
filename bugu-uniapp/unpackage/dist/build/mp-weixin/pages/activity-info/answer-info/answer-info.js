"use strict";var e=require("../../../common/vendor.js"),t=require("../../../common/requestFunctions.js"),s=require("../../../services/answerServices.js"),n=require("../../../common/constants.js"),o=require("../../../utils/request.js"),a=require("../../../utils/dateUtils.js"),i=require("../../../common/storageFunctions.js");require("../../../common/storageKeys.js");const r={data:()=>({AnonymousAvatar:n.AnonymousAvatar,questionTitle:"",questionId:0,answerId:0,answerData:{},answerUser:{},isMe:!1,isDelete:!1,playVideo:!1,videoContext:{},isRefresh:!1,scrollInto:"",contentHeight:0,navHeight:0,myUserInfo:{},commentDatas:[],page:1,haveMoreData:!0,keyboardHeight:0,emojiContentHeight:300,showEmojiPicker:!1,showBottomLoading:!1,refreshCommentId:0,isReplyComment:!1,inputFocus:!1,sendText:"",buttonIsLoading:!1,commentSelected:{},commentMoreSelected:{},isIOS:!1}),onShareAppMessage(){let e="";this.answerData.videoPaths?e=this.answerData.videoPaths[0]+"?vframe/jpg/offset/0":this.answerData.imgPaths&&(e=this.answerData.imgPaths[0]);let t="";return 1==this.answerData.isAnony?t="匿名用户":this.answerUser.username&&(t=this.answerUser.username),{title:`${t}回答了一个问题，快来看看ta说了什么`,path:`/pages/activity-info/answer-info/answer-info?questionTitle=${encodeURIComponent(JSON.stringify(JSON.stringify(this.questionTitle)))}&questionId=${this.questionId}&answerId=${item.issueComment.id}`,imageUrl:e}},onShareTimeline(){let e="";this.answerData.videoPaths?e=this.answerData.videoPaths[0]+"?vframe/jpg/offset/0":this.answerData.imgPaths&&(e=this.answerData.imgPaths[0]);let t="";return 1==this.answerData.isAnony?t="匿名用户":this.answerUser.username&&(t=this.answerUser.username),{title:`${t}回答了一个问题，快来看看ta说了什么`,path:`/pages/activity-info/answer-info/answer-info?questionTitle=${encodeURIComponent(JSON.stringify(JSON.stringify(this.questionTitle)))}&questionId=${this.questionId}&answerId=${item.issueComment.id}`,imageUrl:e}},onReady(){let t=this;e.index.getSystemInfo({success(e){t.contentHeight=e.windowHeight,t.isIOS=-1!=e.system.indexOf("iOS")}}),e.index.createSelectorQuery().select("#answer-info-scroll").boundingClientRect((e=>{t.navHeight=e.top})).exec()},async onLoad(t){e.index.onKeyboardHeightChange((async e=>{0!=e.height?(this.keyboardHeight=e.height,this.emojiContentHeight=e.height,this.showEmojiPicker=!1):this.keyboardHeight=0})),this.answerId=t.answerId;try{this.questionTitle=JSON.parse(JSON.parse(decodeURIComponent(t.questionTitle)))}catch{}if(await this.getAnswerInfo(this.answerId),this.answerUser.id){let e=await i.getMyUserInfo();this.myId=e.id,this.myUserInfo=e,this.isMe=this.answerUser.id==e.id}try{this.questionId=t.questionId}catch{this.questionId=this.answerData.questionId}this.getQuetionsInfo(this.questionId),this.showBottomLoading=!0,this.getAnswerComments(this.answerId,this.page),this.showBottomLoading=!1},computed:{placeholder(){return this.isReplyComment?`回复${this.commentSelected.toUsername}`:"回复作者"},scollerHeight(){return this.contentHeight-this.navHeight},publishTime(){return this.answerData.createTime?a.GettimeifferenceOfNow(this.answerData.createTime).DistanceNow:""},answerAvatar(){return this.answerData?1==this.answerData.isAnonymity?n.AnonymousAvatar:this.answerUser.id?this.answerUser.avatar+n.avatar_pic_hendle:"":""},answerUsername(){return this.answerData?1===this.answerData.isAnonymity?"某只小布咕":this.answerUser.id?this.answerUser.username.length<7?this.answerUser.username:this.answerUser.username.slice(0,7)+"...":"":""}},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onAvatarClick(){0!=this.answerData.isAnony||this.isMe||e.index.navigateTo({url:`/pages/user-home-page/user-home-page?userId=${this.answerUser.id}`})},onMoreClick(){this.$refs.answerActionPopup.open()},onPopupReportClick(){e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${item.id}&objectType=${n.reportObjectType.activity}`}),this.$refs.answerActionPopup.close()},onPopupDeleteClick(){let t=this;e.index.showModal({title:"删除答案",content:"你确定要删除这个答案吗",success:async function(n){n.confirm&&await s.deleteAnswer(t.answerData.id)&&(t.$refs.answerActionPopup.close(),t.isDelete=!1,e.index.showToast({title:"删除成功",icon:"success"}))}})},async onFollow(){if(!this.answerUser.id)return;let s=this;await t.followUser(this.answerUser.id)&&(this.answerUser.isAttention=1,s.$refs.answerActionPopup.close(),e.index.showToast({title:"关注成功",icon:"success"}))},async onCancelFollow(){if(!this.answerUser.id)return;let s=this;e.index.showModal({title:"取消关注",content:`你确定要取消关注${s.answerUser.username}`,success:async function(n){n.confirm&&s.answerUser.id&&await t.cancelAttention(s.answerUser.id)&&(s.answerUser.isAttention=0,s.$refs.answerActionPopup.close(),e.index.showToast({title:"取消关注",icon:"success"}))}})},async onChatClick(){this.answerUser.id&&e.index.navigateTo({url:`/pages/message-secondary-page/chat-content/chat-content?fromUserId=${this.answerUser.id}`})},onImageClick(t){e.index.previewImage({urls:this.answerData.pic,current:t})},onCommentTextareaInput(e){this.sendText=e.detail.value},onCommentTextareaFocus(){this.inputFocus=!0},onCommentTextareaBlur(){setTimeout((()=>{this.inputFocus=!1}),100)},onEmojiIconClick(){this.showEmojiPicker=!this.showEmojiPicker},async onSendButtonClick(){if(!this.questionId||!this.answerId)return;if(this.sendText.length<=0)return;if(this.buttonIsLoading)return;this.refreshCommentId=0,this.buttonIsLoading=!0,this.scrollInto="";let e=!1;e=this.isReplyComment?await s.ReplyAnswerComments(this.commentSelected.commentId,this.sendText,0,this.commentSelected.toUserId):await s.commentAnswer(this.answerId,this.sendText,0),this.buttonIsLoading=!1,this.showEmojiPicker=!1,-1!==e&&(this.isReplyComment?this.refreshCommentId=this.commentSelected.commentId:(this.scrollInto="comment-item-newest",this.isMe&&1==this.answerData.isAnony?this.commentDatas.push({father:{content:this.sendText,createTime:a.getTime(),id:e,isDeleted:0,likeSum:0,isLiked:0,fromUserId:0,publisher:null,responseSum:0,type:0},sons:[]}):this.commentDatas.push({father:{content:this.sendText,createTime:a.getTime(),id:e,isDeleted:0,likeSum:0,isLiked:0,fromUserId:this.myUserInfo.id,publisher:{id:this.myUserInfo.id,username:this.myUserInfo.username,avatar:this.myUserInfo.avatar},responseSum:0,type:0},sons:[]})),this.sendText="")},setEmoj(e){this.sendText=this.sendText+e},async onRefresh(){this.answerId&&(this.isRefresh=!0,await this.getAnswerInfo(this.answerId),this.page=1,this.haveMoreData=!0,this.getAnswerComments(this.answerId,this.page))},async onScrollToLower(){if(this.answerId&&this.haveMoreData){this.showBottomLoading=!0,this.page=this.page+1;let e=await this.getAnswerComments(this.answerId,this.page);e.length>0?this.commentDatas=this.commentDatas.concat(e):this.haveMoreData=!1,this.showBottomLoading=!1}},onAnswerClick(){this.inputFocus?this.inputFocus=!1:this.inputFocus=!0,this.isReplyComment=!1},onCommentPopupReportClick(t){t.isReply?e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${t.replyId}&objectType=${n.reportObjectType.answerCommentResponse}&modular=question`}):e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${t.commentId}&objectType=${n.reportObjectType.answerComment}&modular=question`}),this.$refs.commentActionPopup.close()},onCommentPopupDeleteClick(t){let n=this;e.index.showModal({title:"删除评论",content:"你确定删除这条评论吗？",success:async function(o){if(o.confirm){let o=!1;if(n.refreshCommentId=0,t.isReply)o=await s.deleteAnswerCommentReply(n.answerData.id,t.replyId),o&&(n.refreshCommentId=t.commentId);else{o=await s.deleteAnswerComment(t.commentId);let e=n.commentDatas;for(let s=0;s<e.length;s++)if(e[s].father.id==t.commentId){e[s].father.isDeleted=1;break}n.commentDatas=e}o&&(e.index.showToast({title:"删除成功"}),n.$refs.commentActionPopup.close())}}})},onCommentClick(e){this.isReplyComment=!0,this.inputFocus=!0,this.commentSelected={toUsername:e.publisher.username?e.publisher.username:"某只小布咕",toUserId:0,commentId:e.id}},onCommentMoreClick(e){this.commentMoreSelected={commentId:e.id,replyId:0,fromUserId:e.publisher?e.publisher.id:-1,isReply:!1},this.$refs.commentActionPopup.open()},onShowAllClick(t){e.index.navigateTo({url:`/pages/activity-info/comment-info?commentData=${JSON.stringify(t)}&authorId=${this.answerUser?this.answerUser.id:0}&commentType=answer`})},onReplyClick(e,t,s){this.isReplyComment=!0,this.commentSelected={commentId:e.id,replyId:t.id,toUsername:t.fromUsername,toUserId:0==t.fromUserId?-1:t.fromUserId}},onReplyMoreClick(e,t){this.commentMoreSelected={commentId:e.id,replyId:t.id,fromUserId:0==t.fromUserId?-1:t.fromUserId,isReply:!0},this.$refs.commentActionPopup.open()},async onOpposeButtonClick(){1===this.answerData.isOpposed?(this.answerData.isOpposed=0,this.answerData.opposeSum=this.answerData.opposeSum-1,await s.cancelOpposeAnswer(this.answerData.id)||(this.answerData.isOpposed=1,this.answerData.opposeSum=this.answerData.opposeSum+1,e.index.showToast({title:"取消失败",icon:"error"}))):(this.answerData.isOpposed=1,this.answerData.opposeSum=this.answerData.opposeSum+1,await s.opposeAnswer(this.answerData.id)||(this.answerData.isOpposed=0,this.answerData.opposeSum=this.answerData.opposeSum-1,e.index.showToast({title:"反对失败",icon:"error"})))},async onAgreeButtonClick(){1===this.answerData.isAgreed?(this.answerData.isAgreed=0,this.answerData.agreeSum=this.answerData.agreeSum-1,await s.cancelAgreeAnswer(this.answerData.id)||(this.answerData.isAgreed=1,this.answerData.agreeSum=this.answerData.agreeSum+1,e.index.showToast({title:"取消失败",icon:"error"}))):(this.answerData.isAgreed=1,this.answerData.agreeSum=this.answerData.agreeSum+1,await s.agreeAnswer(this.answerData.id)||(this.answerData.isAgreed=0,this.answerData.agreeSum=this.answerData.agreeSum-1,e.index.showToast({title:"赞同失败",icon:"error"})))},async getQuetionsInfo(e){let t=await o.request({data:{method:"GET",group:"question",action:`${e}/detail`,data:{},header:{"content-type":"application/x-www-form-urlencoded"}}});t.data.code===n.REQUEST_SUCCEEDED_CODE&&(this.questionTitle=t.data.data.title)},async getAnswerInfo(e){let t=await o.request({data:{method:"GET",group:"answer",action:`${e}/detail`,data:{},header:{"content-type":"application/x-www-form-urlencoded"}}});t.data.code===n.REQUEST_SUCCEEDED_CODE&&(this.answerData=t.data.data,this.isMe=1===this.answerData.isMe,this.answerData.isAnonymity||(this.answerUser=this.answerData.publisher))},async getAnswerComments(e,t){let s=await o.request({data:{method:"GET",group:"answer/comment",action:`${e}/commentList`,data:{id:e,father_pageSize:10,father_startPage:t,son_startPage:1,son_pageSize:3},header:{"content-type":"application/x-www-form-urlencoded"}}});if(setTimeout((()=>{this.isRefresh=!1,this.showBottomLoading=!1}),700),s.data.code===n.REQUEST_SUCCEEDED_CODE){let e=s.data.data;if(e.length<1&&(this.haveMoreData=!1),1===t)this.commentDatas=e,this.scrollInto="";else{let t=this.commentDatas.concat(e);this.commentDatas=t}return e}return[]}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("activity-skeleton")+e.resolveComponent("uni-icons")+e.resolveComponent("comment-item")+e.resolveComponent("uni-load-more")+e.resolveComponent("emoji")+e.resolveComponent("uni-transition")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../components/activity-skeleton/activity-skeleton.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../components/comment-item/comment-item.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../components/emoji/emoji.js")+(()=>"../../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../../components/action-sheet/action-sheet.js"))();var m=e._export_sfc(r,[["render",function(t,s,n,o,a,i){return e.e({a:e.o((e=>i.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:e.t(a.questionTitle),d:!a.answerData.id},a.answerData.id?e.e({e:i.answerAvatar,f:e.o((e=>i.onAvatarClick())),g:a.answerUser.isVip&&a.answerUser.isVip.remainDays>0},(a.answerUser.isVip&&a.answerUser.isVip.remainDays,{}),{h:e.t(i.answerUsername),i:a.answerUser.isVerify},(a.answerUser.isVerify,{}),{j:null!=a.answerUser.sex},null!=a.answerUser.sex?{k:e.n(0==a.answerUser.sex?"iconfont icon-nvxing":"iconfont icon-nanxing"),l:0==a.answerUser.sex?"#e86591":"#528cea"}:{},{m:e.t(i.publishTime),n:!a.answerData.isAnony},a.answerData.isAnony?{}:e.e({o:!a.isMe},a.isMe?{}:e.e({p:0==a.answerUser.isAttention},0==a.answerUser.isAttention?{q:e.o((e=>i.onFollow()))}:{r:e.o((e=>i.onChatClick()))})),{s:e.o((e=>i.onMoreClick())),t:e.t(a.answerData.text),v:a.answerData.pic.length>0},a.answerData.pic.length>0?e.e({w:1===a.answerData.isVideo},1===a.answerData.isVideo?{x:e.f(a.answerData.pic,((s,n,o)=>({a:s+"?vframe/jpg/offset/0",b:s,c:"0ce59099-2-"+o,d:e.o(((...e)=>t.onVideoClick&&t.onVideoClick(...e)),s),e:s}))),y:!a.playVideo,z:a.playVideo,A:`video_${a.answerId}`,B:e.o(((...e)=>t.onFullscreenChange&&t.onFullscreenChange(...e))),C:e.p({customPrefix:"customicons",type:"videocam-filled",color:"#c5c5c5dc",size:"100"}),D:!a.playVideo}:{E:e.f(a.answerData.pic,((t,s,n)=>({a:t,b:s,c:e.o((e=>i.onImageClick(t)),s)}))),F:e.n("answer-body-image")}):{},{G:a.answerData.isAgreed},a.answerData.isAgreed?{H:e.t(a.answerData.agreeSum),I:e.o(((...e)=>i.onAgreeButtonClick&&i.onAgreeButtonClick(...e)))}:a.answerData.isOpposed?{K:e.o(((...e)=>i.onOpposeButtonClick&&i.onOpposeButtonClick(...e)))}:{L:e.t(a.answerData.agreeSum),M:e.o(((...e)=>i.onAgreeButtonClick&&i.onAgreeButtonClick(...e))),N:e.o(((...e)=>i.onOpposeButtonClick&&i.onOpposeButtonClick(...e)))},{J:a.answerData.isOpposed,O:e.o((e=>t.onShareClick())),P:e.t(a.answerData.commentSum),Q:e.o(((...e)=>i.onAnswerClick&&i.onAnswerClick(...e)))}):{},{R:e.f(a.commentDatas,((t,s,n)=>({a:t.father.id,b:e.o((e=>i.onCommentClick(t.father)),t.father.id),c:e.o((e=>i.onShowAllClick(t.father)),t.father.id),d:e.o((e=>i.onCommentMoreClick(t.father)),t.father.id),e:e.o(i.onReplyClick,t.father.id),f:e.o(i.onReplyMoreClick,t.father.id),g:"0ce59099-3-"+n,h:e.p({commentType:"answer",commentData:t.father,replyData:t.sons,authorId:a.answerData.isAnony?0:a.answerUser.id,needRefresh:a.refreshCommentId==t.father.id})}))),S:e.p({status:a.haveMoreData?a.showBottomLoading?"loading":"more":"noMore",contentText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:0==a.haveMoreData&&a.commentDatas.length<=0?"还没有评论，快来抢沙发吧~":"没有更多评论了"},iconType:"circle"}),T:a.isRefresh,U:e.o((e=>i.onRefresh())),V:e.o((e=>i.onScrollToLower())),W:a.scrollInto,X:i.scollerHeight+"px",Y:a.isIOS},a.isIOS?{Z:i.placeholder,aa:a.inputFocus,ab:e.o(((...e)=>i.onCommentTextareaFocus&&i.onCommentTextareaFocus(...e))),ac:e.o(((...e)=>i.onCommentTextareaBlur&&i.onCommentTextareaBlur(...e))),ad:a.sendText,ae:e.o((e=>a.sendText=e.detail.value))}:{af:i.placeholder,ag:a.inputFocus,ah:e.o(((...e)=>i.onCommentTextareaFocus&&i.onCommentTextareaFocus(...e))),ai:e.o(((...e)=>i.onCommentTextareaBlur&&i.onCommentTextareaBlur(...e))),aj:a.sendText,ak:e.o((e=>a.sendText=e.detail.value))},{al:e.o((e=>i.onEmojiIconClick())),am:e.t(a.buttonIsLoading?"发送中":"发送"),an:e.o((e=>i.onSendButtonClick())),ao:a.showEmojiPicker,ap:e.o(i.setEmoj),aq:e.p({contentHeight:a.emojiContentHeight}),ar:e.p({"mode-class":"slide-bottom",show:a.showEmojiPicker}),as:a.showEmojiPicker?a.emojiContentHeight+"px":a.keyboardHeight+"px",at:a.answerData.id},a.answerData.id?e.e({av:a.answerData.isAnonymity},a.answerData.isAnonymity?{aw:e.o((e=>i.onPopupReportClick())),ax:e.p({icon:"icon-alert",title:"举报"})}:e.e({ay:a.answerUser.id==t.myId},a.answerUser.id==t.myId?{az:e.o(i.onPopupDeleteClick),aA:e.p({icon:"icon-delete",title:"删除"})}:e.e({aB:1==a.answerUser.isAttention},1==a.answerUser.isAttention?{aC:e.o((e=>i.onCancelFollow())),aD:e.p({icon:"icon-quxiaoguanzhu",title:"取消关注"})}:{aE:e.o((e=>i.onFollow())),aF:e.p({icon:"icon-guanzhu",title:"关注"})},{aG:e.o((e=>i.onChatClick())),aH:e.p({icon:"icon-message",title:"私聊"}),aI:e.o((e=>t.onPopupReportUserClick())),aJ:e.p({icon:"icon-alert",title:"举报"})}))):{},{aK:e.sr("answerActionPopup","0ce59099-7"),aL:e.p({needHead:!0,title:"动态选择",needCancelButton:!0}),aM:a.commentMoreSelected.fromUserId},a.commentMoreSelected.fromUserId?e.e({aN:t.myId==a.commentMoreSelected.fromUserId},t.myId==a.commentMoreSelected.fromUserId?{aO:e.o((e=>i.onCommentPopupDeleteClick(a.commentMoreSelected))),aP:e.p({icon:"icon-delete",title:"删除"})}:e.e({aQ:e.o((e=>i.onCommentPopupReportClick(a.commentMoreSelected))),aR:e.p({icon:"icon-alert",title:"举报"}),aS:a.answerUser.id==t.myId},a.answerUser.id==t.myId?{aT:e.o((e=>i.onCommentPopupDeleteClick(a.commentMoreSelected))),aU:e.p({icon:"icon-delete",title:"删除"})}:{})):{},{aV:e.sr("commentActionPopup","0ce59099-14"),aW:e.p({needHead:!0,title:"评论选择",needCancelButton:!0})})}]]);r.__runtimeHooks=6,wx.createPage(m);
