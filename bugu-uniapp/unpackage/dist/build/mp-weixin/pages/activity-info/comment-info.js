"use strict";var e=require("../../common/vendor.js"),t=require("../../common/storageFunctions.js"),o=require("../../common/requestFunctions.js"),n=require("../../services/answerServices.js"),i=require("../../common/constants.js");require("../../common/storageKeys.js"),require("../../utils/request.js");const m={data:()=>({commentType:"activity",myUserInfo:{},scrollInto:"",commentData:{},authorId:-1,needRefresh:!1,commentSelected:{},commentMoreSelected:{},buttonIsLoading:!1,sendText:"",showEmojiPicker:!1,inputFocus:!1,myId:0,keyboardHeight:0,emojiContentHeight:300,contentHeight:0,navHeight:0,isIOS:!1}),onReady(){let t=this;e.index.getSystemInfo({success(e){t.contentHeight=e.windowHeight,t.isIOS=-1!=e.system.indexOf("iOS")}}),e.index.createSelectorQuery().select("#comment-info-scroll").boundingClientRect((e=>{t.navHeight=e.top})).exec()},async onLoad(o){e.index.onKeyboardHeightChange((async e=>{0!=e.height?(this.keyboardHeight=e.height,this.emojiContentHeight=e.height,this.showEmojiPicker=!1):this.keyboardHeight=0}));let n=o.commentData;this.authorId=Number(o.authorId);let i=o.commentType;if(i&&(this.commentType=i),n){this.commentData=JSON.parse(n);let e=await t.getMyUserInfo();this.myId=e.id,this.myUserInfo=e,this.commentSelected={commentId:this.commentData.id,toUsername:this.commentData.publisher.username,toUserId:0}}},computed:{placeholder(){return this.commentSelected.toUsername?`回复${this.commentSelected.toUsername}`:""},scollerHeight(){return this.contentHeight-this.navHeight}},methods:{onNarLeftClick(){e.index.navigateBack({delta:1})},onCommentTextareaInput(e){this.sendText=e.detail.value},onCommentTextareaFocus(){this.inputFocus=!0},onCommentTextareaBlur(){this.inputFocus=!1},onEmojiIconClick(){this.showEmojiPicker=!this.showEmojiPicker},onScrollToLower(){this.$refs.commentItem.getMoreReplys()},async onSendButtonClick(){if(this.sendText.length<=0)return;if(this.buttonIsLoading)return;this.needRefresh=!1,this.buttonIsLoading=!0,this.scrollInto="";let e={};"index"===this.commentType?e=await o.ReplyComments(this.commentSelected.commentId,this.sendText,0,this.commentSelected.toUserId):"answer"===this.commentType&&(e=await n.ReplyAnswerComments(this.commentSelected.commentId,this.sendText,0,this.commentSelected.toUserId)),this.buttonIsLoading=!1,this.showEmojiPicker=!1,-1!=e&&(this.$refs.commentItem.addReplyItem({content:this.sendText,fromUserId:this.myUserInfo.id,fromUsername:this.myUserInfo.username,id:e,isDeleted:0,toUserId:this.commentSelected.toUserId,toUsername:this.commentSelected.toUsername,type:0,fromUserAvatar:this.myUserInfo.avatar}),this.sendText="",setTimeout((()=>{this.scrollInto="reply-newest"}),1e3))},setEmoj(e){this.sendText=this.sendText+e},onCommentClick(e){this.inputFocus=!0,this.commentSelected={toUsername:e.publisher.username,toUserId:0,commentId:e.id}},onCommentMoreClick(e){this.commentMoreSelected={commentId:e.id,replyId:0,fromUserId:e.publisher.id,isReply:!1},this.$refs.commentActionPopup.open()},onShowAllClick(t){e.index.navigateTo({url:`/pages/activity-info/comment-info?commentData=${JSON.stringify(t)}&authorId=${this.article.publisher?this.article.publisher.id:0}`})},onReplyClick(e,t){this.inputFocus=!0,this.commentSelected={commentId:e.id,replyId:t.id,toUsername:t.fromUsername,toUserId:0==t.fromUserId?-1:t.fromUserId}},onReplyMoreClick(e,t){this.commentMoreSelected={commentId:e.id,replyId:t.id,fromUserId:t.fromUserId,isReply:!0},this.$refs.commentActionPopup.open()},onCommentPopupReportClick(t){t.isReply?e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${t.replyId}&objectType=${i.reportObjectType.commentResponse}`}):e.index.navigateTo({url:`/pages/setting/report-user/report-user?objectId=${t.commentId}&objectType=${i.reportObjectType.comment}`}),this.$refs.commentActionPopup.close()},onCommentPopupDeleteClick(t){let i=this;e.index.showModal({title:"删除评论",content:"你确定删除这条评论吗？",success:async function(m){if(m.confirm){let m=!1;i.needRefresh=!1,t.isReply?("index"===i.commentType?m=await o.DeleteReply(t.replyId):"answer"===i.commentType&&(m=await n.deleteAnswerCommentReply(i.commentData.id,t.replyId)),m&&i.$refs.commentItem.deleteReplyItem(t.replyId)):("index"===i.commentType?m=await o.DeleteComments(t.commentId):"answer"===i.commentType&&(m=await n.deleteAnswerComment(t.commentId)),m&&(i.commentData.isDeleted=!0)),m&&(e.index.showToast({title:"删除成功"}),i.$refs.commentActionPopup.close())}}})}}};if(!Array){(e.resolveComponent("uni-nav-bar")+e.resolveComponent("comment-item")+e.resolveComponent("emoji")+e.resolveComponent("uni-transition")+e.resolveComponent("action-sheet-item")+e.resolveComponent("action-sheet"))()}Math||((()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../components/comment-item/comment-item.js")+(()=>"../../components/emoji/emoji.js")+(()=>"../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../components/action-sheet-item/action-sheet-item.js")+(()=>"../../components/action-sheet/action-sheet.js"))();var s=e._export_sfc(m,[["render",function(t,o,n,i,m,s){return e.e({a:e.o((e=>s.onNarLeftClick())),b:e.p({"left-icon":"back",fixed:"true",backgroundColor:"#fff",color:"#808080",statusBar:"true"}),c:m.commentData.id},m.commentData.id?{d:e.sr("commentItem","e65f5c44-1"),e:e.o((e=>s.onCommentClick(m.commentData))),f:e.o((e=>s.onCommentMoreClick(m.commentData))),g:e.o(s.onReplyClick),h:e.o(s.onReplyMoreClick),i:e.p({commentType:m.commentType,commentData:m.commentData,authorId:m.authorId,needRefresh:m.needRefresh,needShowAll:!0,replyAlign:!0,showReplyCount:!0})}:{},{j:m.scrollInto,k:s.scollerHeight+"px",l:e.o((e=>s.onScrollToLower())),m:m.isIOS},m.isIOS?{n:s.placeholder,o:m.inputFocus,p:e.o(((...e)=>s.onCommentTextareaFocus&&s.onCommentTextareaFocus(...e))),q:e.o(((...e)=>s.onCommentTextareaBlur&&s.onCommentTextareaBlur(...e))),r:m.sendText,s:e.o((e=>m.sendText=e.detail.value))}:{t:s.placeholder,v:m.inputFocus,w:e.o(((...e)=>s.onCommentTextareaFocus&&s.onCommentTextareaFocus(...e))),x:e.o(((...e)=>s.onCommentTextareaBlur&&s.onCommentTextareaBlur(...e))),y:m.sendText,z:e.o((e=>m.sendText=e.detail.value))},{A:e.o((e=>s.onEmojiIconClick())),B:e.t(m.buttonIsLoading?"发送中":"发送"),C:e.o((e=>s.onSendButtonClick())),D:m.showEmojiPicker,E:e.o(s.setEmoj),F:e.p({contentHeight:m.keyboardHeight}),G:m.showEmojiPicker?m.emojiContentHeight+"px":m.keyboardHeight+"px",H:e.p({"mode-class":"slide-bottom",show:m.showEmojiPicker}),I:m.showEmojiPicker?m.emojiContentHeight+"px":m.keyboardHeight+"px",J:m.commentMoreSelected.fromUserId},m.commentMoreSelected.fromUserId?e.e({K:m.myId==m.commentMoreSelected.fromUserId},m.myId==m.commentMoreSelected.fromUserId?{L:e.o((e=>s.onCommentPopupDeleteClick(m.commentMoreSelected))),M:e.p({icon:"icon-delete",title:"删除"})}:e.e({N:e.o((e=>s.onCommentPopupReportClick(m.commentMoreSelected))),O:e.p({icon:"icon-alert",title:"举报"}),P:t.article.publisher&&t.article.publisher.id==m.myId},t.article.publisher&&t.article.publisher.id==m.myId?{Q:e.o((e=>s.onCommentPopupDeleteClick(m.commentMoreSelected))),R:e.p({icon:"icon-delete",title:"删除"})}:{})):{},{S:e.sr("commentActionPopup","e65f5c44-4"),T:e.p({needHead:!0,title:"评论选择",needCancelButton:!0})})}]]);wx.createPage(s);
