"use strict";var e=require("../../common/vendor.js"),t=require("../../common/constants.js"),i=require("../../common/requestFunctions.js");require("../../utils/request.js");const n={name:"user-activity-item",props:{articleItem:{type:Object,required:!0},isMe:{type:Boolean,required:!0},needShowAll:{type:Boolean,default:!1},avatar:{type:String,required:!0},username:{type:String,required:!0}},data:()=>({imageContentStyle:"",numberOfpics:0,maxLength:20,transformTextLength:0,showAll:!0,isLiked:!1,likeSum:0,privateSettingGroup:t.privateSettingGroup,playVideo:!1,videoContext:{}}),beforeMount(){this.isLiked=this.articleItem.isLiked,this.likeSum=this.articleItem.likeSum,this.initText(),this.initImageTypesetting()},methods:{onClick(){this.$emit("onClick")},onMoreClick(){this.$emit("onMoreClick")},onImageClick(t){e.index.previewImage({urls:this.articleItem.pic,current:t})},onVideoClick(){this.playVideo=!0,this.videoContext=e.index.createVideoContext(`video_${this.articleItem.id}`,this),this.videoContext.requestFullScreen({direction:0}),this.videoContext.play()},onFullscreenChange(e){this.playVideo=e.detail.fullScreen,this.playVideo||this.videoContext.stop()},onLabelItemClick(t){e.index.navigateTo({url:`/pages/label-activity/label-activity?labelId=${t.id}&labelContent=${t.content}`})},initText(){let e=this.articleItem.text,t=0,i=e.match(/\n/gi);if(i&&(t=i.length),t<=0)this.transformTextLength=e.length;else if(this.transformTextLength=e.length+19*t,this.transformTextLength>20){let t=e.indexOf("\n"),i=t,n=t,l=e;for(;i<20&&(l=e.slice(n+1),-1!=l.indexOf("\n"));)i=i+20+l.indexOf("\n"),n=n+1+l.indexOf("\n");n<20&&(this.maxLength=n)}console.log(this.maxLength)},initImageTypesetting(){let e=0;this.articleItem.pic.length&&(e=this.articleItem.pic.length),this.imageContentStyle=e<=1?"picture-typesetting-1":2==e||4==e?"picture-typesetting-4":"picture-typesetting-9",this.numberOfpics=e},async onLikeButtonClick(){let e=this.isLiked,t=this.likeSum;if(0==e){this.isLiked=1,this.likeSum=this.likeSum+1,await i.LikeThisArtice(this.articleItem.id)||(this.isLiked=0,this.likeSum=t)}else{this.isLiked=0,this.likeSum=this.likeSum-1,await i.CancleLikeArticle(this.articleItem.id)||(this.isLiked=1,this.likeSum=t)}},onShowAllTextClick(){this.showAll=!this.showAll}}};if(!Array){e.resolveComponent("uni-icons")()}Math;var l=e._export_sfc(n,[["render",function(t,i,n,l,o,s){return e.e({a:n.isMe},n.isMe?{b:e.t(1==n.articleItem.isAnonymity?"咕咕状态":o.privateSettingGroup[n.articleItem.visibility])}:{},{c:e.o((e=>s.onMoreClick())),d:1==n.articleItem.video},1==n.articleItem.video?e.e({e:n.articleItem.pic.length>0},n.articleItem.pic.length>0?{f:o.playVideo,g:n.articleItem.pic[0],h:`video_${n.articleItem.id}`,i:e.o(((...e)=>s.onFullscreenChange&&s.onFullscreenChange(...e))),j:!o.playVideo,k:n.articleItem.pic[0]+"?vframe/jpg/offset/0",l:e.p({customPrefix:"customicons",type:"videocam-filled",color:"#c5c5c5dc",size:"60"}),m:!o.playVideo,n:e.o(((...e)=>s.onVideoClick&&s.onVideoClick(...e)))}:{}):{},{o:1!=n.articleItem.video},1!=n.articleItem.video?e.e({p:n.articleItem.pic.length>0},n.articleItem.pic.length>0?{q:n.articleItem.pic[0]}:{}):{},{r:e.t(n.articleItem.text.length<=o.maxLength?n.articleItem.text:n.articleItem.text.slice(0,o.maxLength)+"..."),s:n.avatar+"?imageView2/1/w/100/h/100",t:e.t(n.username),v:e.t(o.likeSum),w:e.o((e=>s.onLikeButtonClick())),x:e.o(((...e)=>s.onClick&&s.onClick(...e)))})}]]);wx.createComponent(l);
