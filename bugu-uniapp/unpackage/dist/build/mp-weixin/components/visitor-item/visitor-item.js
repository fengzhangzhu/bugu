"use strict";var t=require("../../common/vendor.js"),e=require("../../utils/request.js"),i=require("../../common/constants.js"),o=require("../../utils/dateUtils.js");const n={name:"visitor-item",props:{item:{type:Object,required:!0}},data:()=>({unlocked:!1,visitorInfo:{}}),computed:{avatar(){return this.unlocked&&this.visitorInfo.avatar?this.visitorInfo.avatar:this.item.avatar},username(){return this.unlocked&&this.visitorInfo.username?this.visitorInfo.username:`已经访问过你${this.item.visitSum}次了`},lastTime(){return o.GettimeifferenceOfNow(this.item.lastTime).DistanceNow}},methods:{onUnlockButtonClick(){this.unlocked?t.index.navigateTo({url:`/pages/user-home-page/user-home-page?userId=${this.visitorInfo.id}&isAttention=${this.visitorInfo.isAttention}`}):this.unLockVisitor(this.item.visitorId)},async unLockVisitor(o){t.index.showLoading({title:"正在解锁"});let n=await e.request({data:{method:"GET",group:"user/visitor",action:`${o}/unlock`,data:{visitorId:o},header:{"content-type":"application/x-www-form-urlencoded"}}});return t.index.hideLoading(),n.data.code===i.REQUEST_SUCCEEDED_CODE?(this.unlocked=!0,this.visitorInfo=n.data.data,t.index.showToast({title:"解锁成功",icon:"success"}),!0):"A0203"===n.data.code&&void t.index.showModal({title:"没有权限",content:"只有vip才能查看访客哦~",cancelText:"我知道了",confirmText:"立即充值",success:function(e){e.confirm?t.index.navigateTo({url:"/pages/setting/bugu-vip/bugu-vip"}):e.cancel&&console.log("用户点击取消")}})}}};var s=t._export_sfc(n,[["render",function(e,i,o,n,s,r){return{a:r.avatar+"?imageView2/1/w/100/h/100",b:s.unlocked?"none":" blur(10rpx)",c:t.t(r.username),d:t.t(r.lastTime),e:t.t(s.unlocked?"去Ta的主页":"解锁访客"),f:t.o(((...t)=>r.onUnlockButtonClick&&r.onUnlockButtonClick(...t)))}}]]);wx.createComponent(s);
