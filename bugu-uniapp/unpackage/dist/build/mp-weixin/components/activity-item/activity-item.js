"use strict";var e=require("../../common/vendor.js"),t=require("../../utils/textFilter.js"),i=require("../../common/constants.js"),l=require("../../common/requestFunctions.js"),n=require("../../utils/dateUtils.js");require("../../utils/request.js");const o={name:"activity-item",props:{articleItem:{type:Object,required:!0},isMe:{type:Boolean,required:!0},needShowAll:{type:Boolean,default:!1}},data:()=>({avatar_pic_hendle:i.avatar_pic_hendle,activity_pic_hendle:i.activity_pic_hendle,AnonymousAvatar:i.AnonymousAvatar,imageContentStyle:"",numberOfpics:0,maxLength:100,transformTextLength:0,showAll:!0,isLiked:!1,likeSum:0,isAttention:0,publishTime:"",playVideo:!1,videoContext:{}}),created(){this.isLiked=this.articleItem.isLiked,this.likeSum=this.articleItem.likeSum,this.publishTime=n.GettimeifferenceOfNow(this.articleItem.createTime).DistanceNow,this.articleItem.publisher&&(this.isAttention=this.articleItem.publisher.isAttention),this.initText(),this.initImageTypesetting()},computed:{articleText(){return t.textFilter(this.articleItem.text)}},watch:{articleItem(e){console.log("articleItem"),0==e.isAnonymity&&(this.isAttention=e.publisher.isAttention)}},methods:{onActivityClick(){try{this.$emit("onClick")}catch{}},onAvatarClick(){0!=this.articleItem.isAnonymity||this.isMe||e.index.navigateTo({url:`/pages/user-home-page/user-home-page?userId=${this.articleItem.publisher.id}`})},onChatButtonClick(){e.index.navigateTo({url:`/pages/message-secondary-page/chat-content/chat-content?fromUserId=${this.articleItem.publisher.id}`})},onMoreClick(){console.log("onMoreClick()"),this.$emit("onMoreClick")},onImageClick(t){e.index.previewImage({urls:this.articleItem.pic,current:t})},onVideoClick(){this.playVideo=!0,this.videoContext=e.index.createVideoContext(`video_${this.articleItem.id}`,this),console.log("this.videoContext",this.videoContext),this.videoContext.requestFullScreen({direction:0}),this.videoContext.play()},onFullscreenChange(e){this.playVideo=e.detail.fullScreen,console.log("onFullscreenChange",e),this.playVideo||this.videoContext.stop()},initText(){let e=this.articleItem.text,t=0,i=e.match(/\n/gi);if(i&&(t=i.length),t<=0)this.transformTextLength=e.length;else if(this.transformTextLength=e.length+19*t,this.transformTextLength>100){let t=e.indexOf("\n"),i=t,l=t,n=e;for(;i<100&&(n=e.slice(l+1),-1!=n.indexOf("\n"));)i=i+20+n.indexOf("\n"),l=l+1+n.indexOf("\n");this.maxLength=l}let l=this.transformTextLength<=100;this.needShowAll?this.showAll=!0:this.showAll=l},initImageTypesetting(){let e=0;this.articleItem.pic.length&&(e=this.articleItem.pic.length),this.imageContentStyle=e<=1?"picture-typesetting-1":2==e||4==e?"picture-typesetting-4":"picture-typesetting-9",this.numberOfpics=e},onLabelItemClick(t){e.index.navigateTo({url:`../../pages/label-activity/label-activity?labelId=${t.id}&labelContent=${t.content}`})},onFollowButtonClick(){this.$emit("onFollowClick")},onShareClick(){console.log("onShareClick()"),this.$emit("onShareClick")},async onLikeButtonClick(){let e=this.isLiked,t=this.likeSum;if(0==e){this.isLiked=1,this.likeSum=this.likeSum+1,await l.LikeThisArtice(this.articleItem.id)||(this.isLiked=0,this.likeSum=t)}else{this.isLiked=0,this.likeSum=this.likeSum-1,await l.CancleLikeArticle(this.articleItem.id)||(this.isLiked=1,this.likeSum=t)}},onShowAllTextClick(){this.showAll=!this.showAll}}};if(!Array){e.resolveComponent("uni-icons")()}Math;var s=e._export_sfc(o,[["render",function(t,i,l,n,o,s){return e.e({a:1==l.articleItem.isAnonymity?o.AnonymousAvatar:l.articleItem.publisher.avatar+o.avatar_pic_hendle,b:l.articleItem.publisher&&1==l.articleItem.publisher.isVip},(l.articleItem.publisher&&l.articleItem.publisher.isVip,{}),{c:e.o((e=>s.onAvatarClick())),d:e.t(1==l.articleItem.isAnonymity?"某只小布咕":l.articleItem.publisher.username&&l.articleItem.publisher.username.length>8?l.articleItem.publisher.username.slice(0,8)+"...":l.articleItem.publisher.username),e:l.articleItem.publisher&&1==l.articleItem.publisher.isVerify},(l.articleItem.publisher&&l.articleItem.publisher.isVerify,{}),{f:l.articleItem.publisher&&null!=l.articleItem.publisher.sex},l.articleItem.publisher&&null!=l.articleItem.publisher.sex?{g:e.n(0==l.articleItem.publisher.sex?"iconfont icon-nvxing":"iconfont icon-nanxing"),h:0==l.articleItem.publisher.sex?"#e86591":"#528cea"}:{},{i:e.t(o.publishTime),j:0==l.articleItem.isAnonymity},0==l.articleItem.isAnonymity?e.e({k:!l.isMe},l.isMe?{}:e.e({l:0==l.articleItem.publisher.isAttention},0==l.articleItem.publisher.isAttention?{m:e.o((e=>s.onFollowButtonClick()))}:{n:e.o((e=>s.onChatButtonClick()))})):{},{o:e.o((e=>s.onMoreClick())),p:e.f(l.articleItem.labels,((t,i,l)=>({a:e.t(t.content),b:t.id,c:e.o((e=>s.onLabelItemClick(t)),t.id)}))),q:o.showAll},o.showAll?{r:e.t(s.articleText)}:{s:e.t(s.articleText.slice(0,o.maxLength)+"...")},{t:o.transformTextLength>100},o.transformTextLength>100?e.e({v:o.showAll},o.showAll?{w:e.t("\n收起"),x:e.o((e=>s.onShowAllTextClick()))}:{y:e.t("\n展开"),z:e.o((e=>s.onShowAllTextClick()))}):{},{A:1==l.articleItem.video},1==l.articleItem.video?{B:e.f(l.articleItem.pic,((t,i,l)=>({a:t+"?vframe/jpg/offset/0",b:t,c:"c4ace624-0-"+l,d:e.o(((...e)=>s.onVideoClick&&s.onVideoClick(...e)),t),e:t}))),C:!o.playVideo,D:o.playVideo,E:`video_${l.articleItem.id}`,F:e.o(((...e)=>s.onFullscreenChange&&s.onFullscreenChange(...e))),G:e.p({customPrefix:"customicons",type:"videocam-filled",color:"#c5c5c5dc",size:"100"}),H:!o.playVideo}:{},{I:1!=l.articleItem.video},1!=l.articleItem.video?{J:e.f(l.articleItem.pic,((t,i,l)=>({a:t,b:i,c:e.o((e=>s.onImageClick(t)),i)}))),K:o.numberOfpics<=1?"widthFix":"aspectFill",L:e.n("activity-body-image "+o.imageContentStyle)}:{},{M:1!=l.articleItem.video&&o.numberOfpics<=1?"60vw":"100%",N:e.o((e=>s.onShareClick())),O:e.n(0==o.isLiked?"iconfont icon-dianzan":0==l.articleItem.isLiked?"iconfont icon-dianzan1 is-activity":"iconfont icon-dianzan1"),P:0==o.isLiked?"#b8b8b8":"#83dbcd",Q:e.t(o.likeSum),R:e.o((e=>s.onLikeButtonClick())),S:e.t(l.articleItem.commentSum),T:e.o(((...e)=>s.onActivityClick&&s.onActivityClick(...e)))})}]]);wx.createComponent(s);
